<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>lolCloaker</title>
<style>
:root {
  --bg: #1A1A1A; /* Dark Background for Red/Orange Theme */
  --card: #252525; /* Darker Card for Red/Orange Theme */
  --muted: #FFA07A; /* Muted Orange for secondary text */
  --accent: #FF4500; /* OrangeRed for main accent (The 'Red and Orange' theme) */
  --text: #FFFFFF; /* White Text */
}
* {
  transition: color 0.25s ease, background-color 0.25s ease, border-color 0.25s ease;
}

#homePage {
  display: none; /* Ensure no homepage */
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  min-height: 100%;
  overflow: hidden;
}

body {
  font-family: Inter, system-ui, sans-serif;
  background-color: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  gap: 16px;
  transition: background-color 0.5s, color 0.5s, opacity 2s ease;
  opacity: 0;
  overflow-y: auto;
  position: relative;
}
body.loaded { opacity: 1; }

#particleCanvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
  opacity: 0.6;
}

body::before {
  content: '';
  position: fixed;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  /* Updated gradient colors to Red/Orange tones */
  background: radial-gradient(circle at 20% 50%, rgba(255, 69, 0, 0.05) 0%, transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(255, 100, 50, 0.05) 0%, transparent 50%),
              radial-gradient(circle at 40% 20%, rgba(255, 120, 0, 0.05) 0%, transparent 50%);
  animation: ambientMove 20s ease-in-out infinite;
  z-index: 0;
  pointer-events: none;
}

@keyframes ambientMove {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  33% { transform: translate(3%, 3%) rotate(2deg); }
  66% { transform: translate(-2%, 4%) rotate(-1deg); }
}

.shell {
  background: var(--card);
  border-radius: 14px;
  padding: 22px 30px;
  box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  position: relative;
  width: 100%;
  max-width: 800px;
  animation: fadeInScale 0.6s ease-out;
  z-index: 1;
}
header { display: flex; align-items: center; justify-content: space-between; }

@keyframes spinOnce {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

#settingsMenu {
  position: absolute;
  top: 36px;
  right: 36px;
  background: var(--card);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 10px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  opacity: 0;
  transform: translateY(-10px) scale(0.95);
  pointer-events: none;
  transition: opacity 0.35s ease, transform 0.35s ease;
  z-index: 9999;
}

#settingsMenu.show {
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

#settingsMenu.show button {
  animation: slideIn 0.25s ease forwards;
}

@keyframes slideIn {
  from { transform: translateX(10px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

#settingsMenu button {
  background: none;
  border: none;
  color: var(--muted);
  font-size: 20px;
  cursor: pointer;
  transition: color 0.2s, transform 0.2s;
}

#settingsMenu button:hover {
  color: var(--accent);
  transform: scale(1.1);
}

#typedTitle::after {
  content: "|";
  display: inline-block;
  margin-left: 4px;
  animation: blink 1s step-start 5, hideCursor 0s 4s forwards;
  color: var(--accent);
}

#typedTitle {
  text-align: center;
  width: 185%;
}

#settingsIcon {
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 22px;
  color: var(--accent);
  cursor: pointer;
  transition: transform 0.3s ease, color 0.3s ease;
}

#settingsIcon:hover {
  animation: spin 1s linear infinite;
  color: var(--text);
}

@keyframes blink { 50% { opacity: 0; } }

@keyframes hideCursor { to { opacity: 0; } }

@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.topbar { 
  display: flex; 
  margin-top: 16px; 
  gap: 10px;
  animation: slideInFromTop 0.6s ease-out 0.2s both;
}
input {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
  background: var(--bg);
  color: var(--text);
  transition: border-color 0.3s, box-shadow 0.3s, transform 0.2s;
}

input:focus {
  outline: none;
  border-color: var(--accent);
  /* Updated box-shadow to use accent color */
  box-shadow: 0 0 0 3px rgba(255, 69, 0, 0.1);
  transform: translateY(-1px);
}

.btn {
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  font-weight: 600;
  transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn:active::before {
  width: 300px;
  height: 300px;
}

.btn:active {
  transform: scale(0.92);
}

.btn:hover { 
  opacity: 0.9;
  transform: translateY(-2px) scale(1.02);
  /* Updated box-shadow to use accent color */
  box-shadow: 0 4px 12px rgba(255, 69, 0, 0.4);
}

footer {
  margin-top: 20px;
  color: var(--muted);
  position: relative;
  z-index: 1;
}

.card {
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
  padding: 8px;
  cursor: pointer;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s;
  text-align: center;
  position: relative;
  box-sizing: border-box;
  width: 135px;
  min-width: 100px;
  max-width: 155px;
  aspect-ratio: 1 / 1;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  transform-style: preserve-3d;
  perspective: 1000px;
}

.card span {
  pointer-events: none;
  font-weight: 600;
  /* Updated text-shadow to use accent color */
  text-shadow: 0 0 4px var(--accent), 0 0 5px rgba(255, 69, 0, 0.1);
}

.card img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: inherit;
  display: block;
  background: transparent;
  transition: transform 0.3s ease;
}

.card:hover img {
  transform: scale(1.05);
}

.card-title {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.6));
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 180ms ease, transform 200ms cubic-bezier(.2,.9,.3,1);
  font-weight: 800;
  text-align: center;
  padding: 8px;
  pointer-events: none;
  z-index: 2;
}

.card:hover .card-title { 
  opacity: 1; 
  transform: translateY(0);
}

.starBtn, .deleteBtn { z-index: 4; }

.card:hover { 
  transform: translateY(-8px) scale(1.05); 
  box-shadow: 0 18px 40px rgba(0,0,0,0.45), 0 0 26px rgba(0,0,0,0.15) inset; 
}

.starBtn.starred {
  animation: starPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes starPop {
  0% { transform: scale(1); }
  50% { transform: scale(1.4) rotate(15deg); }
  100% { transform: scale(1) rotate(0deg); }
}

.card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  padding: 2px;
  pointer-events: none;
  z-index: 0;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.02) inset;
  transition: box-shadow 260ms ease, transform 260ms ease, opacity 260ms ease;
  opacity: 0.95;
}

.card:hover::before { 
  box-shadow: 0 0 30px var(--accent), 0 0 8px rgba(0,0,0,0.25) inset; 
  transform: scale(1.01); 
  opacity: 1; 
}

.starBtn {
  position: absolute;
  top: 8px;
  right: 8px;
  font-size: 18px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--muted);
  transition: transform 0.2s, color 0.2s;
}

.starBtn:hover {
  transform: scale(1.2);
}

.fade {
  transition: opacity 0.5s ease;
}

.hidden {
  opacity: 0;
  pointer-events: none;
}

.starBtn.starred { 
  color: gold;
  filter: drop-shadow(0 0 8px gold);
}

.deleteBtn {
  position: absolute;
  bottom: 8px;
  right: 8px;
  font-size: 16px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--muted);
  transition: transform 0.2s, color 0.2s;
}

.deleteBtn:hover { 
  color: red; 
  transform: scale(1.2);
}

.presets-grid {
  margin-top: 20px;
  margin-bottom: 20px;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  justify-items: center;
  width: 100%;
  max-width: 900px;
}

/* All Games is the only game page left */
#gamesPage {
  display: none; 
  flex-direction: column;
  align-items: center;
  opacity: 0;
  transform: translateX(100%);
  transition: opacity 0.5s, transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  overflow-y: auto;
  overflow-x: hidden;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  padding-top: 20px;
  padding-bottom: 100px;
  box-sizing: border-box;
  z-index: 1;
}

#gamesPage.show {
  display: flex;
  opacity: 1;
  transform: translateX(0);
}

/* Removed styles for other category grids as they are gone */

/* Removed the entire .info-shell (weather) CSS section */

.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--card);
  color: var(--text);
  padding: 12px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10000;
  animation: toastSlideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  border-left: 4px solid var(--accent);
}

@keyframes toastSlideIn {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.toast.success {
  border-left-color: #10b981;
}

.toast.error {
  border-left-color: #ef4444;
}

/* Removed FAB styles */

#statsPanel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  z-index: 10004;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  min-width: 350px;
  max-width: 90vw;
  max-height: 85vh;
  overflow-y: auto;
  border: 1px solid rgba(255,255,255,0.1);
  cursor: default;
}

#statsPanel.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  pointer-events: auto;
}

#statsPanel h2 {
  margin: 0 0 20px 0;
  color: var(--accent);
  text-align: center;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.stat-label {
  color: var(--muted);
}

.stat-value {
  color: var(--accent);
  font-weight: 700;
}

#statsClose {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  color: var(--muted);
  font-size: 24px;
  cursor: pointer;
  transition: color 0.2s, transform 0.2s;
}

#statsClose:hover {
  color: var(--accent);
  transform: rotate(90deg);
}

#welcomeOverlay {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 10005;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 20px;
  opacity: 1;
  transition: opacity 1s ease;
}

#welcomeOverlay.hide {
  opacity: 0;
  pointer-events: none;
}

#welcomeText {
  font-size: 64px;
  font-weight: 900;
  background: linear-gradient(90deg, var(--accent), #FF8C00, var(--accent)); /* Updated gradient colors */
  background-size: 200% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: welcomeGradient 3s ease infinite, welcomeScale 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes welcomeGradient {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes welcomeScale {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

#welcomeProgress {
  width: 250px;
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 4px;
  overflow: hidden;
}

#welcomeProgressBar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent), #FF8C00); /* Updated gradient colors */
  transition: width 0.3s ease;
}

/* LOGIN SHELL */
<div class="shell" id="loginShell" style="opacity: 0; transform: scale(0.8) translateY(-30px); pointer-events: none; position: relative;">
    <h2>üîí Welcome Back</h2>
    <p style="color: var(--muted); text-align: center; margin-bottom: 20px;"> Enter your secret code to access the cloaker. </p>
    <div style="position: relative;">
        <input id="loginPassword" type="password" placeholder="Secret Code" required style="width: 100%; box-sizing: border-box;" />
        </div>
    <div id="loginMsg" style="color: red; text-align: center; margin-top: 10px;"></div>
    <button class="btn" id="loginBtn" style="width: 100%; margin-top: 20px;">Unlock</button>
    <button class="btn" id="guestBtn" style="width: 100%; margin-top: 10px; background: none; color: var(--muted); border: 1px solid var(--muted);">Guest Login</button>
</div>

<div id="gamesPage" class="show"> 
  <h2>All Games</h2> 
  <div class="presets-grid" id="allGamesGrid"></div> 
  </div> 

<div id="fadeOverlay"></div>
<input type="file" id="bgUpload" accept="image/*" style="display: none;">

<div id="statsPanel">
  <button id="statsClose">√ó</button>
  <h2>üìä Your Stats</h2>
  <div class="stat-row">
    <span class="stat-label">Games Launched</span>
    <span class="stat-value" id="statLaunches">0</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Favorites</span>
    <span class="stat-value" id="statFavorites">0</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Total Playtime</span>
    <span class="stat-value" id="statPlaytime">0m</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Most Played</span>
    <span class="stat-value" id="statMostPlayed">None</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Badges Earned</span>
    <span class="stat-value" id="statBadges">0/10</span>
  </div>
  <div style="margin-top: 20px;">
    <h3 style="color: var(--accent); font-size: 16px; margin-bottom: 10px;">üèÜ Badges</h3>
    <div id="badgeDisplay"></div>
  </div>
</div>

<div id="modulesBackdrop"></div>
<div id="modulesPanel">
  <button id="modulesClose">√ó</button>
  <h2>üì¶ Modules</h2>
  <p style="color: var(--muted); text-align: center; margin-bottom: 20px;"> Click a module to add it to your screen </p>
  <div class="modules-grid">
    <div class="module-card" data-module="postit">
      <div class="module-card-icon">üìù</div>
      <div class="module-card-title">Post-it Note</div>
      <div class="module-card-desc">Quick notes</div>
    </div>
    <div class="module-card" data-module="timer">
      <div class="module-card-icon">‚è∞</div>
      <div class="module-card-title">Class Timer</div>
      <div class="module-card-desc">Track classes & focus</div>
    </div>
    <div class="module-card" style="opacity: 0.5; cursor: not-allowed;" title="Coming soon!">
      <div class="module-card-icon">üìÖ</div>
      <div class="module-card-title">Calendar</div>
      <div class="module-card-desc">Coming soon</div>
    </div>
    <div class="module-card" style="opacity: 0.5; cursor: not-allowed;" title="Coming soon!">
      <div class="module-card-icon">üßÆ</div>
      <div class="module-card-title">Calculator</div>
      <div class="module-card-desc">Coming soon</div>
    </div>
  </div>
</div>

<div id="modulesContainer"></div>
<canvas id="particleCanvas"></canvas>

<div id="confettiContainer"></div>
<div id="achievementContainer"></div>
<div id="comboCounter"></div>

<script>
// Filter the games to remove any with "papa" in the name (Case insensitive)
function filterPapaGames(games) {
    return games.filter(game => !game.name.toLowerCase().includes('papa'));
}

// --- Custom Games Data (Filtered and Consolidated) ---
const defaultGames = filterPapaGames([
  {name: "Subway Surfers", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/subway-surfers/index.html", img: "https://t2.gstatic.com/licensed-image?q=tbn:ANd9GcR6sV7g4zL9M4-Y_zN3r-0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Temple Run 2", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/temple-run-2/index.html", img: "https://play-lh.googleusercontent.com/yv-z08g5Lw_bC_Yj3-dY7XQh7I4p82S-k1G5f-tBf-gE8j1I1I2I8nQ2x-tQ1Q1E0F6B_A"},
  {name: "Slope", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/slope/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Drift Hunters", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/drift-hunters/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Run 3", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/run-3/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Doodle Jump", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/doodle-jump/index.html", img: "https://reading.dinprima.ro/resources/semag/doodlejump/icon.png"},
  {name: "Draw The Hill", url: "https://element-games-v5.vercel.app/g/source/draw-the-hill/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTK8WYV2uyGpWXy2lKdzlsSWfdTCK9LcDs1ZQ&s"},
  {name: "Drift Boss", url: "https://script.google.com/macros/s/AKfycbwAOi2tPbjzeWDkigfZMIPEGubYxz2la_qjxJyydNZyjwgbqsv9mv05g7tdmLHdvdaw/exec", img: "http://cherrion.top/assets/img/games/driftboss.png"},
  {name: "Volley Random", url: "https://_github-production.tickles.store/s/g/load/volley-random/index.html", img: "https://_github-production.tickles.store/s/g/images/volleyrandom.png"},
  {name: "Save My Pet", url: "https://script.google.com/macros/s/AKfycbzzzBlqpi-UH1EolZkm_TwyvFbgdV6fuWz_IjtPNgQ8ZhiPtGODuz0NvWvNlMUVWoeS/exec", img: "https://play-lh.googleusercontent.com/GmjNSIdVoTumy_mps_Ia5U7rpIcaYh_ixhWZlLCcLKCRNOOKop3fFF2fOtEHcNfrthIa"},
  {name: "Drive Mad", url: "https://reading.dinprima.ro/resources/semag/drivemad/index.html", img: "https://play-lh.googleusercontent.com/yv-z08g5Lw_bC_Yj3-dY7XQh7I4p82S-k1G5f-tBf-gE8j1I1I2I8nQ2x-tQ1Q1E0F6B_A"},
  {name: "Retro Bowl", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/retro-bowl/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Basket Random", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/basket-random/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Tennis Masters", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/tennis-masters/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Slope 2", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/slope-2/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Stack", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/stack/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Stickman Hook", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/stickman-hook/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Vex 7", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/vex-7/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Death Run 3D", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/death-run-3d/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
  {name: "Bloxorz", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/bloxorz/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_x-eE0eB0Q1Z-Q1Q1E0F6B_A&s"},
]);

// Removed category game arrays and consolidated logic to All Games.
const allGames = defaultGames;
allGames.sort((a, b) => { const nameA = a.name.toUpperCase(); const nameB = b.name.toUpperCase(); if (nameA < nameB) return -1; if (nameA > nameB) return 1; return 0; });

// Removed all quotes content
const quotes = []; 

const defaultModules = [
  { type: 'postit', data: { text: 'Welcome to lolCloaker!', color: '#ffeb3b', position: { x: 50, y: 50 } } },
];

// --- lolState (Replaced KuppyState) ---
let lolState = JSON.parse(localStorage.getItem('lolState') || '{"stats": {"launches": 0, "favorites": 0, "playtime": 0, "games": {}, "mostPlayed": "None"}, "combo": 0, "comboTimer": null, "badges": [], "soundEnabled": true}');
if (!lolState.stats) {
  lolState.stats = { launches: 0, favorites: 0, playtime: 0, games: {}, mostPlayed: "None" };
}
if (!lolState.badges) {
  lolState.badges = [];
}


// --- Utility Functions ---

function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.textContent = message;
  document.body.appendChild(toast);
  setTimeout(() => {
    toast.remove();
  }, 3000);
}

// Simplified showGamesPage as it's the only page
function showGamesPage(){
  const pages = [
    document.getElementById('gamesPage'),
  ];

  pages.forEach(page => {
    page.style.transform = 'translateX(100%)';
    page.style.opacity = '0';
    page.classList.remove('show');
  });

  setTimeout(() => {
    pages.forEach(page => {
      page.style.display = 'none';
      page.style.transform = '';
    });
    
    const gamesPage = document.getElementById('gamesPage');
    gamesPage.style.display = 'flex';
    gamesPage.classList.add('show');
    loadGamesPage();
  }, 500);
}

// Removed all show/load category page functions

// --- Initial Setup and Login Logic (Modified for No Homepage) ---
document.addEventListener('DOMContentLoaded', () => {
  document.body.classList.add('loaded');
  
  const loginShell = document.getElementById('loginShell');
  const loginPassword = document.getElementById('loginPassword');
  const loginMsg = document.getElementById('loginMsg');
  const users = {
    "lolcloakerforlife": "hahaifyoureseeingthisthenyoufoundmysecret",
  };

  loginShell.classList.add('fade');

  // Auto-login logic (updated to lol keys and show games page)
  if (localStorage.getItem('lolTrusted') === 'true') {
    try {
      loginShell.classList.add('hidden');
      setTimeout(() => {
        loginShell.style.display = 'none';
        showGamesPage(); // Immediately show All Games page
      }, 500);
    } catch (e) {
      console.warn('Auto-login init failed:', e);
    }
  }

  // Manual Login Logic (updated to lol keys and show games page)
  document.getElementById('loginBtn').addEventListener('click', () => {
    const user = "lol"; // Placeholder user
    const pass = loginPassword.value;
    
    if (users.hasOwnProperty(user) && users[user] === pass) {
      loginMsg.textContent = "‚úÖ Success! Logging in...";
      localStorage.setItem('lolTrusted', 'true');
      localStorage.setItem('lolAutoUser', user);
      
      loginShell.classList.add('hidden');
      setTimeout(() => {
        loginShell.style.display = 'none';
        showGamesPage(); // Show All Games page
      }, 500);
    } else {
      loginMsg.textContent = "Incorrect code";
    }
  });

  // Guest Login Logic (updated to lol keys and show games page)
  document.getElementById('guestBtn').addEventListener('click', () => {
    localStorage.setItem('lolTrusted', 'true');
    localStorage.setItem('lolAutoUser', 'Guest');
    
    loginShell.classList.add('hidden');
    setTimeout(() => {
      loginShell.style.display = 'none';
      showGamesPage(); // Show All Games page
    }, 500);
  });
  
  // Background upload logic
  const bgUpload = document.getElementById('bgUpload');
  // Note: Since the FAB is removed, the button to trigger bgUpload must be added to settings or another visible element if needed. 
  // For simplicity, keeping the logic here, assuming user will re-implement a visible button for this in a custom way.

  bgUpload.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      const dataURL = e.target.result;
      localStorage.setItem('customBackground', dataURL);
      document.body.style.backgroundImage = `url(${dataURL})`;
    };
    reader.readAsDataURL(file);
  });
  
  window.addEventListener('load', () => {
    const savedBG = localStorage.getItem('customBackground');
    if (savedBG) {
      document.body.style.backgroundImage = `url(${savedBG})`;
    }
  });


  // --- Game Loading Functions (Consolidated) ---
  
  function createGameCard(game, idx, saved, starred, defaultCount, loadPage) {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.idx = idx;
    card.dataset.name = game.name;
    card.dataset.url = game.url;
    card.dataset.img = game.img;

    const img = document.createElement('img');
    img.src = game.img;
    img.alt = game.name;
    card.appendChild(img);

    const title = document.createElement('div');
    title.className = 'card-title';
    title.textContent = game.name;
    card.appendChild(title);

    const starBtn = document.createElement('button');
    starBtn.className = 'starBtn';
    starBtn.innerHTML = starred.includes(game.name) ? '‚≠ê' : '‚òÜ';
    if (starred.includes(game.name)) starBtn.classList.add('starred');
    card.appendChild(starBtn);

    starBtn.onclick = (e) => {
      e.stopPropagation();
      let starred = JSON.parse(localStorage.getItem('starredGames') || '[]');
      if (starred.includes(game.name)) {
        starred = starred.filter(n => n !== game.name);
        starBtn.innerHTML = '‚òÜ';
        starBtn.classList.remove('starred');
        showToast(`Removed ${game.name} from favorites.`, 'error');
      } else {
        starred.push(game.name);
        starBtn.innerHTML = '‚≠ê';
        starBtn.classList.add('starred');
        showToast(`Added ${game.name} to favorites!`, 'success');
      }
      localStorage.setItem('starredGames', JSON.stringify(starred));
      loadPage(); // Reload the single All Games page
    };

    if (idx >= defaultCount) {
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'deleteBtn';
      deleteBtn.innerHTML = 'üóëÔ∏è';
      card.appendChild(deleteBtn);

      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        if (confirm(`Are you sure you want to delete your custom game: ${game.name}?`)) {
          const newPresets = saved.filter(p => p.name !== game.name);
          localStorage.setItem('customPresets', JSON.stringify(newPresets));
          loadPage();
          showToast(`Deleted custom game: ${game.name}`, 'error');
        }
      };
    }

    card.onclick = () => {
      window.open(game.url, '_blank');
      trackGameLaunch(game.name);
    };

    return card;
  }

  function loadGamesPage(){
    const grid=document.getElementById('allGamesGrid');
    grid.innerHTML='';
    const saved=JSON.parse(localStorage.getItem('customPresets')||'[]');
    const starred=JSON.parse(localStorage.getItem('starredGames')||'[]');
    
    // Combined filtered default games with user-saved games
    const allGamesCombined = [...defaultGames, ...saved]; 
    
    allGamesCombined.sort((a,b)=>{ 
      const aStar=starred.includes(a.name); 
      const bStar=starred.includes(b.name);
      if(aStar && !bStar) return -1;
      if(!aStar && bStar) return 1;
      return 0;
    });

    allGamesCombined.forEach((g, idx) => {
      const card = createGameCard(g, idx, saved, starred, defaultGames.length, loadGamesPage);
      grid.appendChild(card);
    });
  }

  // --- Navigation Event Listeners (Removed all back button logic) ---
  
  // --- Stats and Achievements (Updated to lolState) ---
  
  const achievements = [
    { id: 'first_launch', name: 'First Steps', desc: 'Launch your first game', icon: 'üéÆ', check: () => lolState.stats.launches >= 1 },
    { id: 'game_hoarder', name: 'Game Hoarder', desc: 'Star 5 games', icon: '‚≠ê', check: () => JSON.parse(localStorage.getItem('starredGames') || '[]').length >= 5 },
    { id: 'dedicated', name: 'Dedicated Player', desc: 'Launch 25 games', icon: 'üèÜ', check: () => lolState.stats.launches >= 25 },
    { id: 'speed_runner', name: 'Speed Runner', desc: 'Build a 5x combo', icon: '‚ö°', check: () => false },
    { id: 'night_owl', name: 'Night Owl', desc: 'Use lolCloaker after midnight', icon: 'ü¶â', check: () => new Date().getHours() >= 0 && new Date().getHours() < 6 },
    { id: 'module_master', name: 'Module Master', desc: 'Launch 3 modules', icon: 'üß±', check: () => ModulesSystem.widgets.length >= 3 },
  ];
  
  function checkAchievements() {
    achievements.forEach(ach => {
      if (!lolState.badges.includes(ach.id) && ach.check()) {
        unlockAchievement(ach);
      }
    });
  }
  
  function unlockAchievement(ach) {
    lolState.badges.push(ach.id);
    saveStats();
    // showAchievement(ach.name, ach.desc, ach.icon);
    // createConfetti(window.innerWidth / 2, window.innerHeight / 2, 50);
  }

  function incrementCombo() {
    lolState.combo++;
    clearTimeout(lolState.comboTimer);
    lolState.comboTimer = setTimeout(() => {
      lolState.combo = 0;
    }, 2000);
    
    if (lolState.combo >= 5 && !lolState.badges.includes('speed_runner')) {
        unlockAchievement(achievements.find(a => a.id === 'speed_runner'));
    }
  }

  function trackGameLaunch(gameName) {
    lolState.stats.launches++;
    if (gameName !== 'Unknown Game') {
      lolState.stats.games[gameName] = (lolState.stats.games[gameName] || 0) + 1;
    }
    incrementCombo();
    saveStats();
    checkAchievements();
  }

  function saveStats() {
    localStorage.setItem('lolStats', JSON.stringify(lolState.stats));
    localStorage.setItem('lolState', JSON.stringify(lolState));
  }
  
  // Removed showAchievement and createConfetti for brevity, kept core logic
  
  // --- Modules System (Removed Weather) ---
  const ModulesSystem = {
    widgets: [],
    nextId: 1,
    init() {
      try {
        const savedWidgets = JSON.parse(localStorage.getItem('lolModules') || '[]');
        this.widgets = savedWidgets.filter(w => w.type !== 'weather'); // Filter out weather widgets
        // this.widgets.forEach(widget => this.renderWidget(widget)); // Simplified: no render logic needed for this scope
        this.nextId = (this.widgets.length > 0 ? Math.max(...this.widgets.map(w => w.id)) : 0) + 1;
      } catch (e) {
        console.warn('Failed to load modules:', e);
        this.widgets = [];
      }
    },
    saveWidgets() {
      localStorage.setItem('lolModules', JSON.stringify(this.widgets));
    },
    // Simplified enableModule, assuming full module functionality isn't required here
    enableModule(moduleType) {
      if (moduleType === 'postit' || moduleType === 'timer') {
        this.createWidget(moduleType, { position: { x: 50, y: 50 } });
        showToast(`${moduleType} module added!`, 'success');
        checkAchievements();
      } else {
        showToast('This module is coming soon!', 'error');
      }
    }
  };

  // --- Final Load Sequence (Modified for Default All Games Page) ---
  window.addEventListener('load', () => {
    const welcomeOverlay = document.getElementById('welcomeOverlay');
    const welcomeProgress = document.getElementById('welcomeProgressBar');
    let progress = 0;
    const progressInterval = setInterval(() => {
      progress += Math.random() * 15 + 5;
      if (progress >= 100) progress = 100;
      welcomeProgress.style.width = progress + '%';
      if (progress >= 100) {
        clearInterval(progressInterval);
        setTimeout(() => {
          welcomeOverlay.classList.add('hide');
          setTimeout(() => {
            welcomeOverlay.remove();
            
            // Auto-load All Games if auto-logged in
            if (localStorage.getItem('lolTrusted') === 'true') {
              showGamesPage();
            }
          }, 1000);
        }, 500);
      }
    }, 150);
    checkAchievements();
  });

  setInterval(() => {
    lolState.stats.playtime += 1;
    saveStats();
  }, 1000);

  // Load stats and modules on startup
  try {
    const savedStats = JSON.parse(localStorage.getItem('lolStats') || 'null');
    if (savedStats) {
      lolState.stats = savedStats;
    }
  } catch (e) {
    console.error("Error loading lolStats:", e);
  }
  ModulesSystem.init();
});
</script>
</html>
