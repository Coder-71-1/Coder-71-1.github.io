<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KuppyCloaker</title>
<style>
:root {
  --bg: #0f1724;
  --card: #0b1220;
  --muted: #93a3b8;
  --accent: #007bff;
  --text: #e6eef8;
}
* {
  transition: color 0.25s ease, background-color 0.25s ease, border-color 0.25s ease;
}

#homePage {
  display: none;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  min-height: 100%;
  overflow: hidden;
}

body {
  font-family: Inter, system-ui, sans-serif;
  background-color: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  gap: 16px;
  transition: background-color 0.5s, color 0.5s, opacity 2s ease;
  opacity: 0;
  overflow-y: auto;
  position: relative;
}
body.loaded { opacity: 1; }

#particleCanvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
  opacity: 0.6;
}

body::before {
  content: '';
  position: fixed;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle at 20% 50%, rgba(0, 123, 255, 0.03) 0%, transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(147, 51, 234, 0.03) 0%, transparent 50%),
              radial-gradient(circle at 40% 20%, rgba(59, 130, 246, 0.02) 0%, transparent 50%);
  animation: ambientMove 20s ease-in-out infinite;
  z-index: 0;
  pointer-events: none;
}

@keyframes ambientMove {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  33% { transform: translate(3%, 3%) rotate(2deg); }
  66% { transform: translate(-2%, 4%) rotate(-1deg); }
}

.shell {
  background: var(--card);
  border-radius: 14px;
  padding: 22px 30px;
  box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  position: relative;
  width: 100%;
  max-width: 800px;
  animation: fadeInScale 0.6s ease-out;
  z-index: 1;
}
header { display: flex; align-items: center; justify-content: space-between; }

@keyframes spinOnce {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

#settingsMenu {
  position: absolute;
  top: 36px;
  right: 36px;
  background: var(--card);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 10px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  opacity: 0;
  transform: translateY(-10px) scale(0.95);
  pointer-events: none;
  transition: opacity 0.35s ease, transform 0.35s ease;
  z-index: 9999;
}

#settingsMenu.show {
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

#settingsMenu.show button {
  animation: slideIn 0.25s ease forwards;
}

@keyframes slideIn {
  from { transform: translateX(10px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

#settingsMenu button {
  background: none;
  border: none;
  color: var(--muted);
  font-size: 20px;
  cursor: pointer;
  transition: color 0.2s, transform 0.2s;
}

#settingsMenu button:hover {
  color: var(--accent);
  transform: scale(1.1);
}

#typedTitle::after {
  content: "|";
  display: inline-block;
  margin-left: 4px;
  animation: blink 1s step-start 5, hideCursor 0s 4s forwards;
  color: var(--accent);
}

#typedTitle {
  text-align: center;
  width: 185%;
}

#settingsIcon {
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 22px;
  color: var(--accent, #007bff);
  cursor: pointer;
  transition: transform 0.3s ease, color 0.3s ease;
}

#settingsIcon:hover {
  animation: spin 1s linear infinite;
  color: var(--text, #fff);
}

@keyframes blink { 50% { opacity: 0; } }

@keyframes hideCursor { to { opacity: 0; } }

@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInFromBottom {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes slideInFromLeft {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInFromRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes gentlePulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02);
  }
}

@keyframes weatherIconFloat {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-5px);
  }
}

.topbar { 
  display: flex; 
  margin-top: 16px; 
  gap: 10px;
  animation: slideInFromTop 0.6s ease-out 0.2s both;
}
input {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
  background: var(--bg);
  color: var(--text);
  transition: border-color 0.3s, box-shadow 0.3s, transform 0.2s;
}

input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
  transform: translateY(-1px);
}

.btn {
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  font-weight: 600;
  transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn:active::before {
  width: 300px;
  height: 300px;
}

.btn:active {
  transform: scale(0.92);
}

.btn:hover { 
  opacity: 0.9;
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
}

footer {
  margin-top: 20px;
  color: var(--muted);
  position: relative;
  z-index: 1;
}

.card {
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
  padding: 8px;
  cursor: pointer;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s;
  text-align: center;
  position: relative;
  box-sizing: border-box;
  width: 135px;
  min-width: 100px;
  max-width: 155px;
  aspect-ratio: 1 / 1;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  transform-style: preserve-3d;
  perspective: 1000px;
}

.card span {
  pointer-events: none;
  font-weight: 600;
  text-shadow: 0 0 4px var(--accent), 0 0 5px rgba(0, 123, 255, 0.1);
}

.card img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: inherit;
  display: block;
  background: transparent;
  transition: transform 0.3s ease;
}

.card:hover img {
  transform: scale(1.05);
}

.card-title {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.6));
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 180ms ease, transform 200ms cubic-bezier(.2,.9,.3,1);
  font-weight: 800;
  text-align: center;
  padding: 8px;
  pointer-events: none;
  z-index: 2;
}

.card:hover .card-title { 
  opacity: 1; 
  transform: translateY(0);
}

.starBtn, .deleteBtn { z-index: 4; }

.card:hover { 
  transform: translateY(-8px) scale(1.05); 
  box-shadow: 0 18px 40px rgba(0,0,0,0.45), 0 0 26px rgba(0,0,0,0.15) inset; 
}

.starBtn.starred {
  animation: starPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes starPop {
  0% { transform: scale(1); }
  50% { transform: scale(1.4) rotate(15deg); }
  100% { transform: scale(1) rotate(0deg); }
}

.card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  padding: 2px;
  pointer-events: none;
  z-index: 0;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.02) inset;
  transition: box-shadow 260ms ease, transform 260ms ease, opacity 260ms ease;
  opacity: 0.95;
}

.card:hover::before { 
  box-shadow: 0 0 30px var(--accent), 0 0 8px rgba(0,0,0,0.25) inset; 
  transform: scale(1.01); 
  opacity: 1; 
}

@keyframes floatSlow { 0% { transform: translateY(0); } 50% { transform: translateY(-4px); } 100% { transform: translateY(0); } }

@keyframes pulseAccent { 0% { box-shadow: 0 0 0 rgba(0,0,0,0); } 50% { box-shadow: 0 0 18px rgba(0,123,255,0.12); } 100% { box-shadow: 0 0 0 rgba(0,0,0,0); } }

.starBtn {
  position: absolute;
  top: 8px;
  right: 8px;
  font-size: 18px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--muted);
  transition: transform 0.2s, color 0.2s;
}

.starBtn:hover {
  transform: scale(1.2);
}

.fade {
  transition: opacity 0.5s ease;
}

.hidden {
  opacity: 0;
  pointer-events: none;
}

.forms-icon img {
  width: 20px;
  height: 20px;
  vertical-align: middle;
  margin-left: 8px;
  transition: transform 0.25s ease, filter 0.25s ease;
}

.starBtn.starred { 
  color: gold;
  filter: drop-shadow(0 0 8px gold);
}

.deleteBtn {
  position: absolute;
  bottom: 8px;
  right: 8px;
  font-size: 16px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--muted);
  transition: transform 0.2s, color 0.2s;
}

.deleteBtn:hover { 
  color: red; 
  transform: scale(1.2);
}

.presets-grid {
  margin-top: 20px;
  margin-bottom: 20px;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  justify-items: center;
  width: 100%;
  max-width: 900px;
}

.skeleton {
  background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

#gamesPage, #multigamesPage, #puzzlegamesPage, #obbygamesPage, #sportsgamesPage {
  display: none;
  flex-direction: column;
  align-items: center;
  opacity: 0;
  transform: translateX(100%);
  transition: opacity 0.5s, transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  overflow-y: auto;
  overflow-x: hidden;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  padding-top: 20px;
  padding-bottom: 100px;
  box-sizing: border-box;
  z-index: 1;
}

#gamesPage.show, #multigamesPage.show, 
#puzzlegamesPage.show, #obbygamesPage.show, #sportsgamesPage.show {
  display: flex;
  opacity: 1;
  transform: translateX(0);
}

.multiplayer-grid, .puzzle-grid, .obby-grid, .sports-grid {
  margin-top: 20px;
  margin-bottom: 20px;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  justify-items: center;
  width: 100%;
  max-width: 900px;
}

.info-shell {
  background: var(--card);
  border-radius: 12px;
  padding: 16px 24px;
  box-shadow: 0 8px 20px rgba(2,6,23,0.5);
  display: flex;
  align-items: center;
  gap: 32px;
  border: 1px solid rgba(255,255,255,0.05);
  width: 100%;
  max-width: 800px;
  animation: fadeInScale 0.6s ease-out;
  z-index: 1;
  position: relative;
}

.time-section {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 140px;
  animation: slideInFromLeft 0.6s ease-out;
}

.time-display {
  font-size: 32px;
  font-weight: 700;
  color: var(--text);
  letter-spacing: -0.5px;
  line-height: 1;
}

.date-display {
  font-size: 13px;
  color: var(--muted);
  font-weight: 500;
}

.divider {
  width: 1px;
  height: 50px;
  background: rgba(255,255,255,0.1);
}

.weather-section {
  display: flex;
  align-items: center;
  gap: 16px;
  flex: 1;
  animation: slideInFromRight 0.6s ease-out 0.1s both;
}

.weather-icon {
  font-size: 40px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  animation: weatherIconFloat 3s ease-in-out infinite;
  position: relative;
}

.weather-icon.rainy::after {
  content: 'üíß';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 16px;
  animation: rainDrop 1s infinite;
}

@keyframes rainDrop {
  0% { opacity: 1; transform: translateX(-50%) translateY(0); }
  100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
}

.weather-icon.sunny {
  animation: weatherIconFloat 3s ease-in-out infinite, sunRotate 8s linear infinite;
}

@keyframes sunRotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.weather-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.temperature {
  font-size: 28px;
  font-weight: 700;
  color: var(--text);
  line-height: 1;
}

.weather-desc {
  font-size: 13px;
  color: var(--muted);
  text-transform: capitalize;
  font-weight: 500;
}

.weather-details {
  display: flex;
  gap: 16px;
  margin-left: auto;
  font-size: 12px;
  color: var(--muted);
}

.weather-detail {
  display: flex;
  flex-direction: column;
  gap: 2px;
  text-align: center;
}

.detail-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  opacity: 0.7;
}

.detail-value {
  font-weight: 600;
  color: var(--text);
  font-size: 13px;
}

.starred-games-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1001;
}

.starred-game-icon {
  position: absolute;
  width: 90px;
  height: 90px;
  pointer-events: auto;
  cursor: grab;
  transition: box-shadow 0.2s, transform 0.2s;
  border-radius: 12px;
  overflow: hidden;
  background: var(--card);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  user-select: none;
  animation: fadeInScale 0.5s ease-out backwards;
}

.starred-game-icon.dragging {
  cursor: grabbing;
  opacity: 0.8;
  z-index: 1000;
  transition: none;
}

.starred-game-icon:hover:not(.dragging) {
  transform: scale(1.1);
  box-shadow: 0 8px 20px rgba(0,0,0,0.5), 0 0 20px var(--accent);
}

.starred-game-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: inherit;
}

#fadeOverlay {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:black;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.5s;
  z-index:9999;
}

#fadeOverlay.active { 
  opacity:1; 
  pointer-events:auto; 
}

.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--card);
  color: var(--text);
  padding: 12px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10000;
  animation: toastSlideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  border-left: 4px solid var(--accent);
}

@keyframes toastSlideIn {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.toast.success {
  border-left-color: #10b981;
}

.toast.error {
  border-left-color: #ef4444;
}

body.weather-rain::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(transparent 0%, rgba(30, 58, 138, 0.1) 100%);
  pointer-events: none;
  z-index: 0;
}

body.weather-snow::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(transparent 0%, rgba(219, 234, 254, 0.1) 100%);
  pointer-events: none;
  z-index: 0;
}

body.weather-sunny::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at 70% 30%, rgba(251, 191, 36, 0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  pointer-events: none;
  z-index: 10000;
  animation: confettiFall 3s ease-out forwards;
}

@keyframes confettiFall {
  0% {
    transform: translateY(0) rotateZ(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotateZ(720deg);
    opacity: 0;
  }
}

.achievement {
  position: fixed;
  top: 80px;
  right: -400px;
  background: linear-gradient(135deg, var(--card) 0%, rgba(0, 123, 255, 0.2) 100%);
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  gap: 16px;
  border-left: 4px solid gold;
  z-index: 10001;
  animation: achievementSlide 4s cubic-bezier(0.34, 1.56, 0.64, 1);
  max-width: 350px;
}

@keyframes achievementSlide {
  0% { right: -400px; }
  15% { right: 20px; }
  85% { right: 20px; }
  100% { right: -400px; }
}

.achievement-icon {
  font-size: 48px;
  animation: achievementPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes achievementPop {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3) rotate(10deg); }
}

.achievement-content h3 {
  margin: 0;
  color: gold;
  font-size: 16px;
  text-shadow: 0 0 10px gold;
}

.achievement-content p {
  margin: 4px 0 0 0;
  color: var(--muted);
  font-size: 13px;
}

#comboCounter {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  font-size: 72px;
  font-weight: 900;
  color: var(--accent);
  text-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent);
  z-index: 10002;
  pointer-events: none;
  opacity: 0;
}

#comboCounter.show {
  animation: comboAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes comboAppear {
  0% {
    transform: translate(-50%, -50%) scale(0) rotate(-10deg);
    opacity: 0;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(1) rotate(0deg);
    opacity: 1;
  }
}

body.shake {
  animation: screenShake 0.5s ease-in-out;
}

@keyframes screenShake {
  0%, 100% { transform: translate(0, 0); }
  10% { transform: translate(-5px, 2px); }
  20% { transform: translate(5px, -2px); }
  30% { transform: translate(-5px, -2px); }
  40% { transform: translate(5px, 2px); }
  50% { transform: translate(-5px, 2px); }
  60% { transform: translate(5px, -2px); }
  70% { transform: translate(-5px, -2px); }
  80% { transform: translate(5px, 2px); }
  90% { transform: translate(-5px, -2px); }
}

.breathe {
  animation: breathe 3s ease-in-out infinite;
}

@keyframes breathe {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.02); opacity: 0.9; }
}

.card.flipping {
  animation: cardFlip 0.6s ease-in-out;
}

@keyframes cardFlip {
  0% { transform: rotateY(0deg) scale(1); }
  50% { transform: rotateY(90deg) scale(0.9); }
  100% { transform: rotateY(0deg) scale(1); }
}

#fab {
  position: fixed;
  bottom: 25px;
  right: 25px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent) 0%, #0056b3 100%);
  color: white;
  font-size: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
  z-index: 1000;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s;
  animation: fabPulse 2s ease-in-out infinite;
}

@keyframes fabPulse {
  0%, 100% { box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4); }
  50% { box-shadow: 0 6px 30px rgba(0, 123, 255, 0.8); }
}

#fab:hover {
  transform: scale(1.1) rotate(90deg);
}

#fabMenu {
  position: fixed;
  bottom: 110px;
  right: 20px;
  background: var(--card);
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
  gap: 8px;
  opacity: 0;
  transform: scale(0.8) translateY(20px);
  pointer-events: none;
  transition: opacity 0.3s, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  z-index: 999;
}

#fabMenu.show {
  opacity: 1;
  transform: scale(1) translateY(0);
  pointer-events: auto;
}

.fab-item {
  padding: 10px 16px;
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  color: var(--text);
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
  white-space: nowrap;
  font-size: 14px;
}

.fab-item:hover {
  background: var(--accent);
  transform: translateX(-5px);
}

#statsPanel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  z-index: 10004;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  min-width: 350px;
  max-width: 90vw;
  max-height: 85vh;
  overflow-y: auto;
  border: 1px solid rgba(255,255,255,0.1);
  cursor: default;
}

#statsPanel.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  pointer-events: auto;
}

#statsPanel h2 {
  margin: 0 0 20px 0;
  color: var(--accent);
  text-align: center;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.stat-label {
  color: var(--muted);
}

.stat-value {
  color: var(--accent);
  font-weight: 700;
}

#statsClose {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  color: var(--muted);
  font-size: 24px;
  cursor: pointer;
  transition: color 0.2s, transform 0.2s;
}

#statsClose:hover {
  color: var(--accent);
  transform: rotate(90deg);
}

#welcomeOverlay {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 10005;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 20px;
  opacity: 1;
  transition: opacity 1s ease;
}

#welcomeOverlay.hide {
  opacity: 0;
  pointer-events: none;
}

#welcomeText {
  font-size: 64px;
  font-weight: 900;
  background: linear-gradient(90deg, var(--accent), #9333ea, var(--accent));
  background-size: 200% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: welcomeGradient 3s ease infinite, welcomeScale 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes welcomeGradient {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes welcomeScale {
  0% { transform: scale(0) rotate(-10deg); opacity: 0; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

#welcomeSubtext {
  color: var(--muted);
  font-size: 18px;
  animation: fadeInUp 1s ease 0.5s both;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.matrix-char {
  position: fixed;
  color: #00ff00;
  font-family: monospace;
  font-size: 16px;
  pointer-events: none;
  z-index: 0;
  text-shadow: 0 0 5px #00ff00;
  animation: matrixFall linear forwards;
}

@keyframes matrixFall {
  to {
    transform: translateY(100vh);
    opacity: 0;
  }
}

.easter-egg-found {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 120px;
  z-index: 10006;
  pointer-events: none;
  animation: easterEggReveal 2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes easterEggReveal {
  0% {
    transform: translate(-50%, -50%) scale(0) rotate(-180deg);
    opacity: 0;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.5) rotate(10deg);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(0) rotate(180deg);
    opacity: 0;
  }
}

.progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), #9333ea);
  z-index: 10007;
  transition: width 0.3s ease;
  box-shadow: 0 0 10px var(--accent);
}

.badge {
  display: inline-block;
  width: 40px;
  height: 40px;
  margin: 5px;
  border-radius: 50%;
  background: linear-gradient(135deg, gold, #ff8c00);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
  animation: badgeShine 2s ease-in-out infinite;
  position: relative;
}

@keyframes badgeShine {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.3); }
}

.badge.locked {
  background: rgba(255,255,255,0.1);
  filter: grayscale(1);
  opacity: 0.3;
}

.badge::after {
  content: '';
  position: absolute;
  inset: -5px;
  border-radius: 50%;
  border: 2px solid transparent;
  animation: badgeRing 2s ease-in-out infinite;
}

@keyframes badgeRing {
  0%, 100% { 
    border-color: transparent;
    transform: scale(1);
  }
  50% { 
    border-color: gold;
    transform: scale(1.2);
  }
}

/* Modules System */
#modulesPanel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: var(--card);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  z-index: 10003;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  min-width: 400px;
  max-width: 90vw;
  max-height: 85vh;
  overflow-y: auto;
  border: 1px solid rgba(255,255,255,0.1);
}

#modulesPanel.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  pointer-events: auto;
}

#modulesBackdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(5px);
  z-index: 10002;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}

#modulesBackdrop.show {
  opacity: 1;
  pointer-events: auto;
}

#modulesPanel h2 {
  margin: 0 0 20px 0;
  color: var(--accent);
  text-align: center;
}

#modulesClose {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  color: var(--muted);
  font-size: 24px;
  cursor: pointer;
  transition: color 0.2s, transform 0.2s;
}

#modulesClose:hover {
  color: var(--accent);
  transform: rotate(90deg);
}

.modules-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

.module-card {
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
  border: 2px solid rgba(255,255,255,0.1);
}

.module-card:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3), 0 0 20px var(--accent);
  background: rgba(255,255,255,0.08);
  border-color: var(--accent);
}

.module-card-icon {
  font-size: 48px;
  margin-bottom: 12px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.module-card-title {
  font-weight: 600;
  color: var(--text);
  font-size: 14px;
  margin-bottom: 4px;
}

.module-card-desc {
  font-size: 12px;
  color: var(--muted);
}

/* Post-it Note Widget */
.postit-widget {
  background: linear-gradient(135deg, var(--postit-color, #ffd54f) 0%, var(--postit-color-light, #ffeb3b) 100%) !important;
  border: none !important;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3), 0 0 0 3px rgba(0,0,0,0.1), 
              inset 0 -2px 4px rgba(0,0,0,0.1) !important;
  width: 280px;
  height: 280px;
  border-radius: 4px !important;
  position: relative;
  resize: both !important;
  overflow: hidden !important;
  min-width: 200px !important;
  min-height: 200px !important;
  max-width: 600px !important;
  max-height: 600px !important;
}

.postit-widget::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 40px;
  background: linear-gradient(to bottom, rgba(255,255,255,0.3), transparent);
  border-radius: 4px 4px 0 0;
  pointer-events: none;
}

.postit-widget .widget-header {
  background: rgba(0,0,0,0.08) !important;
  border-bottom: 1px solid rgba(0,0,0,0.1);
  position: relative;
  z-index: 1;
  cursor: move;
  padding: 8px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.postit-title-input {
  background: transparent !important;
  border: none !important;
  color: #333 !important;
  font-weight: 700 !important;
  font-family: Inter, system-ui, sans-serif !important;
  font-size: 14px !important;
  outline: none !important;
  padding: 4px 8px !important;
  border-radius: 4px !important;
  transition: background 0.2s !important;
  flex: 1;
  min-width: 100px;
}

.postit-title-input:hover,
.postit-title-input:focus {
  background: rgba(255,255,255,0.3) !important;
}

.postit-title-input::placeholder {
  color: rgba(0,0,0,0.4) !important;
}

.postit-widget .widget-controls {
  display: flex;
  gap: 4px;
}

.postit-widget .widget-btn {
  background: rgba(0,0,0,0.1) !important;
  border: 1px solid rgba(0,0,0,0.2) !important;
  color: #333 !important;
  width: 24px;
  height: 24px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
}

.postit-widget .widget-btn:hover {
  background: rgba(0,0,0,0.2) !important;
  transform: scale(1.1);
}

.postit-widget .widget-delete:hover {
  background: rgba(255, 0, 0, 0.3) !important;
  color: #cc0000 !important;
  border-color: #cc0000 !important;
}

.postit-widget .widget-content {
  background: transparent;
  padding: 12px;
  height: calc(100% - 100px);
  overflow: auto;
}

.postit-textarea {
  width: 100% !important;
  height: 100% !important;
  background: transparent !important;
  border: none !important;
  color: #333 !important;
  font-family: Inter, system-ui, sans-serif !important;
  font-size: 14px !important;
  line-height: 1.6 !important;
  resize: none !important;
  outline: none !important;
  padding: 0 !important;
  box-sizing: border-box !important;
}

.postit-textarea::placeholder {
  color: rgba(0,0,0,0.4) !important;
  font-style: italic;
}

.postit-colors {
  display: flex;
  gap: 6px;
  padding: 8px 12px;
  background: rgba(0,0,0,0.05);
  border-top: 1px solid rgba(0,0,0,0.1);
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
}

.postit-color-btn {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid transparent;
  transition: transform 0.2s, border-color 0.2s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.postit-color-btn:hover {
  transform: scale(1.2);
}

.postit-color-btn.active {
  border-color: #333;
  box-shadow: 0 0 0 2px rgba(0,0,0,0.3);
}

/* Class Timer Widget */
.timer-widget {
  background: linear-gradient(135deg, #1a1f35 0%, #2d3548 100%) !important;
  border: 2px solid rgba(0, 123, 255, 0.3) !important;
  box-shadow: 0 8px 20px rgba(0,0,0,0.4), 0 0 30px rgba(0, 123, 255, 0.2) !important;
  width: 320px;
  min-height: 280px;
  border-radius: 12px !important;
  position: relative;
  overflow: hidden !important;
}

.timer-widget .widget-header {
  background: rgba(0, 123, 255, 0.1) !important;
  border-bottom: 1px solid rgba(0, 123, 255, 0.3);
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: move;
}

.timer-widget .widget-title {
  color: var(--accent);
  font-weight: 700;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.timer-widget .widget-content {
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.timer-block {
  background: rgba(0, 123, 255, 0.1);
  border-radius: 8px;
  padding: 12px;
  border-left: 3px solid var(--accent);
}

.timer-block-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--muted);
  margin-bottom: 4px;
}

.timer-block-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
}

.timer-countdown {
  text-align: center;
  padding: 20px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  margin: 10px 0;
}

.timer-countdown-time {
  font-size: 36px;
  font-weight: 900;
  color: var(--accent);
  font-family: 'Courier New', monospace;
  text-shadow: 0 0 10px var(--accent);
}

.timer-countdown-label {
  font-size: 12px;
  color: var(--muted);
  margin-top: 4px;
}

.timer-controls {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.timer-btn {
  flex: 1;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 6px;
  padding: 10px;
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  transition: all 0.2s;
}

.timer-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
}

.timer-btn.secondary {
  background: rgba(255, 255, 255, 0.1);
}

.timer-btn.secondary:hover {
  background: rgba(255, 255, 255, 0.15);
}

.focus-mode-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 30px;
  animation: fadeIn 0.5s ease;
}

.focus-mode-title {
  font-size: 48px;
  font-weight: 900;
  color: var(--accent);
  text-shadow: 0 0 20px var(--accent);
}

.focus-mode-timer {
  font-size: 72px;
  font-weight: 900;
  font-family: 'Courier New', monospace;
  color: white;
  text-shadow: 0 0 30px var(--accent);
}

.focus-mode-message {
  font-size: 18px;
  color: var(--muted);
  text-align: center;
}

.focus-mode-exit {
  margin-top: 20px;
  background: rgba(255, 0, 0, 0.2);
  border: 1px solid rgba(255, 0, 0, 0.5);
  color: #ff6b6b;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}

.focus-mode-exit:hover {
  background: rgba(255, 0, 0, 0.3);
  transform: scale(1.05);
}

/* Timer Settings Panel */
.timer-settings-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: var(--card);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  z-index: 10004;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  min-width: 500px;
  max-width: 90vw;
  max-height: 85vh;
  overflow-y: auto;
  border: 1px solid rgba(255,255,255,0.1);
}

.timer-settings-panel.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  pointer-events: auto;
}

.class-input-row {
  display: grid;
  grid-template-columns: 120px 1fr;
  gap: 12px;
  margin-bottom: 12px;
  align-items: center;
}

.class-input-row label {
  color: var(--muted);
  font-size: 13px;
  font-weight: 600;
}

.class-input-row input {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,0.1);
  background: var(--bg);
  color: var(--text);
  font-size: 14px;
}

.focus-duration-selector {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.duration-btn {
  flex: 1;
  padding: 10px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  color: var(--text);
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
}

.duration-btn:hover {
  background: rgba(255,255,255,0.1);
  transform: translateY(-2px);
}

.duration-btn.active {
  background: var(--accent);
  border-color: var(--accent);
}

</style>
</head>
<body>
<canvas id="particleCanvas"></canvas>

<div id="comboCounter">x0</div>

<div id="fab">‚ö°</div>
<div id="fabMenu">
  <div class="fab-item" id="fabModules">üì¶ Modules</div>
  <div class="fab-item" id="fabStats">üìä Stats</div>
  <div class="fab-item" id="lightToggle">üí° Light</div>
  <div class="fab-item" id="colorToggle">üé® Theme</div>
  <input type="file" id="bgUpload" accept="image/*" style="display:none;"> 
  <div class="fab-item" id="bgButton">üñºÔ∏è Background</div> 
</div>

<div id="statsPanel">
  <button id="statsClose">√ó</button>
  <h2>üìä Your Stats</h2>
  <div class="stat-row">
    <span class="stat-label">Games Launched</span>
    <span class="stat-value" id="statLaunches">0</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Favorites</span>
    <span class="stat-value" id="statFavorites">0</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Total Playtime</span>
    <span class="stat-value" id="statPlaytime">0m</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Most Played</span>
    <span class="stat-value" id="statMostPlayed">None</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Badges Earned</span>
    <span class="stat-value" id="statBadges">0/10</span>
  </div>
  <div style="margin-top: 20px;">
    <h3 style="color: var(--accent); font-size: 16px; margin-bottom: 10px;">üèÜ Badges</h3>
    <div id="badgeDisplay"></div>
  </div>
</div>

<div id="modulesBackdrop"></div>

<div id="modulesPanel">
  <button id="modulesClose">√ó</button>
  <h2>üì¶ Modules</h2>
  <p style="color: var(--muted); text-align: center; margin-bottom: 20px;">
    Click a module to add it to your screen
  </p>
  
  <div class="modules-grid">
    <div class="module-card" data-module="postit">
      <div class="module-card-icon">üìù</div>
      <div class="module-card-title">Post-it Note</div>
      <div class="module-card-desc">Quick notes</div>
    </div>
    
<div class="module-card" data-module="weather">
  <div class="module-card-icon">üå§Ô∏è</div>
  <div class="module-card-title">Weather</div>
  <div class="module-card-desc">Live weather & time info</div>
</div>

<div class="module-card" data-module="timer">
  <div class="module-card-icon">‚è∞</div>
  <div class="module-card-title">Class Timer</div>
  <div class="module-card-desc">Track classes & focus</div>
</div>
    
    <div class="module-card" style="opacity: 0.5; cursor: not-allowed;" title="Coming soon!">
      <div class="module-card-icon">üìÖ</div>
      <div class="module-card-title">Calendar</div>
      <div class="module-card-desc">Coming soon</div>
    </div>
    
    <div class="module-card" style="opacity: 0.5; cursor: not-allowed;" title="Coming soon!">
      <div class="module-card-icon">üßÆ</div>
      <div class="module-card-title">Calculator</div>
      <div class="module-card-desc">Coming soon</div>
    </div>
  </div>
</div>

<div id="welcomeOverlay">
  <div id="welcomeText">KuppyCloaker</div>
  <div id="welcomeSubtext"></div>
  <div class="progress-bar" style="position: relative; width: 300px; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 20px;">
    <div id="welcomeProgress" class="progress-bar" style="position: absolute;"></div>
  </div>
</div>
<div class="shell" id="loginShell" style="display:flex; justify-content:center; align-items:center; height:100vh;">

  <div class="login-card" style="background:var(--card); padding:30px; border-radius:16px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:320px; text-align:center;">
    <h1 style="color:var(--accent); margin-bottom:5px;">KuppyCloaker</h1>
    <p id="loginMsg" style="color:red; font-size:12px; height:16px;"></p>
    
<div style="width: 80%; margin: 0 auto 10px auto; box-sizing: border-box;">
  <input id="loginUsername" type="text" placeholder="Username"
         style="width: 100%; padding:10px; margin-bottom:5px; border-radius:8px; border:none; outline:none; font-family: Inter, system-ui, sans-serif; box-sizing: border-box;" />
</div>

<div style="width: 80%; margin: 0 auto 20px auto; position: relative; box-sizing: border-box;">
  <input id="loginPassword" type="password" placeholder="Access Code"
         style="width: 100%; padding:10px 40px 10px 10px; border-radius:8px; border:none; outline:none; font-family: Inter, system-ui, sans-serif; box-sizing: border-box;" />
  <span id="togglePassword" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; user-select:none; color:var(--muted); font-size:16px;">üëÅÔ∏è</span>
</div>
</div>
</div>
<div class="starred-games-container" id="starredGamesContainer"></div>
<div class="info-shell" id="infoShell" style="display:none; margin-bottom:50px;">
  <div class="time-section">
    <div class="time-display" id="timeDisplay">--:--</div>
    <div class="date-display" id="dateDisplay">Loading...</div>
  </div>
  
  <div class="divider"></div>
  
  <div class="weather-section">
    <div class="weather-icon" id="weatherIcon">üå§Ô∏è</div>
    <div class="weather-info">
      <div class="temperature" id="temperature">--¬∞</div>
      <div class="weather-desc" id="weatherDesc">Loading weather...</div>
    </div>
    <div class="weather-details">
      <div class="weather-detail">
        <div class="detail-label">Feels</div>
        <div class="detail-value" id="feelsLike">--¬∞</div>
      </div>
      <div class="weather-detail">
        <div class="detail-label">Humid</div>
        <div class="detail-value" id="humidity">--%</div>
      </div>
      <div class="weather-detail">
        <div class="detail-label">Wind</div>
        <div class="detail-value" id="windSpeed">-- mph</div>
      </div>
    </div>
  </div>
</div>
<div class="shell" id="homePage">
<header style="position: relative;">
  <div id="userDisplay" style="position:absolute; top:12px; left:12px; color:var(--accent); font-weight:bold; text-shadow: 0 0 6px var(--accent); font-size:18px;"></div>
  <div style="display: flex; flex-direction: column; align-items: center; width: 100%;">
    <h1 id="typedTitle" style="color:white;"></h1>
    <p style="color:var(--muted); font-size:14px; text-align:center;">
      Lightweight, seamless cloaker. Paste a URL or click a button to start playing instantly.
    </p>
  </div>
    <div style="position:absolute;top:12px;right:12px;">
      <div id="settingsMenu">
      </div>
    </div>
  </header>

  <div class="topbar">
    <input id="websiteInput" type="text" placeholder="Enter a game URL" />
  </div>

<div style="display:flex; flex-direction:column; align-items:center; width:100%; gap:10px; margin-top:20px; margin-bottom:10px;">

<div style="display:flex; justify-content:center; gap:10px; margin-bottom:10px; animation: slideInFromBottom 0.6s ease-out 0.4s both;">
    <button class="btn" id="sportsGamesBtn">‚öΩ Sports</button>    
    <button class="btn" id="multiGamesBtn">üßë‚Äçü§ù‚Äçüßë Multiplayer</button>
    <button class="btn" id="puzzleGamesBtn">üß© Puzzle</button>    
    <button class="btn" id="obbyGamesBtn">üèÉ Obby</button>
  </div>

<div style="display:flex; justify-content:center; gap:10px; animation: slideInFromBottom 0.6s ease-out 0.5s both;">    <button class="btn" id="allGamesBtn">üéÆ All Games</button>    
    <button class="btn" id="recentGamesBtn">üïì Recent</button>
    <button class="btn" id="dailyGameBtn">üìÖ Daily Game</button>
    <button class="btn" id="randomGameBtn">üé≤ Random Game</button>
  </div>

</div>

  <div id="homeTab" class="tabContent" style="margin-top:20px;">
    
<div style="text-align:center; margin-top:10px;">
</div>
  </div>

<footer>
  <div>
    <div style="display:flex; align-items:center; gap:6px;">
      <span>‚Äî Kuppy</span>
      </a>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSfJDMVpKyTUI2vJoUUcEjCRgWS39s8Yai-5KmWawSi15l0r8Q/viewform?usp=header" 
         target="_blank" 
         title="Send Feedback">
        <img src="https://www.gstatic.com/images/branding/product/1x/forms_2020q4_48dp.png" 
             alt="Forms" 
             style="width:24px; height:24px; vertical-align:middle; border:none;"/>
      </a>
    </div>
  </div>
</footer></div>

<div id="gamesPage">
  <h2>All Games</h2>
  <div class="presets-grid" id="allGamesGrid"></div>
  <button id="backBtn" class="btn" style="margin-top:20px;">‚¨Ö Back</button>
</div>

<div id="multigamesPage">
  <h2>Multiplayer Games</h2>
  <div class="multiplayer-grid" id="multiGamesGrid"></div>
  <button id="multiBackBtn" class="btn" style="margin-top:20px;">‚¨Ö Back</button>
</div>

<div id="puzzlegamesPage">
  <h2>Puzzle Games</h2>
  <div class="puzzle-grid" id="puzzleGamesGrid"></div>
  <button id="puzzleBackBtn" class="btn" style="margin-top:20px;">‚¨Ö Back</button>
</div>

<div id="obbygamesPage">
  <h2>Obby Games</h2>
  <div class="obby-grid" id="obbyGamesGrid"></div>
  <button id="obbyBackBtn" class="btn" style="margin-top:20px;">‚¨Ö Back</button>
</div>

<div id="sportsgamesPage">
  <h2>Sports Games</h2>
  <div class="sports-grid" id="sportsGamesGrid"></div>
  <button id="sportsBackBtn" class="btn" style="margin-top:20px;">‚¨Ö Back</button>
</div>

<div id="fadeOverlay"></div>

<div id="widgetsContainer"></div>

<script>
const defaultGames = [
  {name: "2048", url: "https://reading.dinprima.ro/resources/semag/2048/index.html", img: "https://upload.wikimedia.org/wikipedia/commons/1/1a/2048_Icon.png"},
  {name: "Adventure Capitalist", url: "https://reading.dinprima.ro/resources/semag/adventure-capitalist/index.html", img: "https://www.andyroid.net/wp-content/uploads/2015/06/AdVenture-Capitalist-icon.png"},
  {name: "Backyard Baseball", url: "https://script.google.com/macros/s/AKfycbxCGoMs4wmjd_c08SeWaKuJKh9BoQlovbZIbPtzK03OLOQ6CmmImR9s6HpsxCtaHYbi/exec", img: "https://play-lh.googleusercontent.com/DwEQoD1zm9FLxRstBtdWZUXNxgyWgSsOjM0ILPtlAm1L1X7f2RZdmrjizTlOAdoDF_8=w240-h480-rw"},
  {name: "Backyard Basketball", url: "https://script.google.com/macros/s/AKfycbzutG_IKsHOQPExLK1OU1gKUy0FzeES71P13XgouwmJWvJaDi8U26ivFGRD_IHuFIDJ/exec", img: "https://play-lh.googleusercontent.com/xDCBTMTXfhB6HKHVHZXOq06e3c_7d2Ehrdqh62IcCojuX5cAMaO2wIU9tX-J-HZjtT0"},
  {name: "Baldi's Basics", url: "https://reading.dinprima.ro/resources/semag/baldis-basics/index.html", img: "https://reading.dinprima.ro/resources/semag/baldis-basics/splash.png"},
  {name: "Basket Random", url: "https://classroomlesson.github.io/basic-ruffle-player/html/basket_random/index.html", img: "https://play-lh.googleusercontent.com/gP8T5Z1O-ngxIloiwcBZzrzyLPYDp0R_1BDNKUDZboIRPVImeyWI8-7aExvB9gAGNKc"},
  {name: "Basket Bros", url: "https://player-nation.anjumanallana.in/resources/semag/basketbros/index.html", img: "https://player-nation.anjumanallana.in/resources/semag/basketbros/thumb.jpg"},
  {name: "Basketball Stars", url: "https://reading.dinprima.ro/resources/semag/basketball-stars/index.html", img: "https://cherrion.top/assets/img/games/bballstars.png"},
  {name: "BitLife", url: "https://reading.dinprima.ro/resources/semag/bitlife/index.html", img: "https://reading.dinprima.ro/resources/semag/bitlife/bitlife.png"},
  {name: "Block Blast", url: "https://classroomlesson.github.io/basic-ruffle-player/html/blocky_puzzle/index.html", img: "https://play-lh.googleusercontent.com/mBpKOJBdmZLHFEfIMT0s27O-jX4MyAXqX-vhugHlTE0FKj188WmFCRElxY-inKX1tMA"},
  {name: "Bloxors", url: "https://classroomlesson.github.io/basic-ruffle-player/html/bloxorz/index.html", img: "https://play-lh.googleusercontent.com/FZ0qdNb8S1h4iJ4X0pBviJbH7odiOB06BRa-hmrjGfq0S5CAvs8suU-FZllXNVbUZgtm=w240-h480-rw"},
  {name: "Boxing Random", url: "https://element-games-v5.vercel.app/g/source/boxing-random/index.html", img: "https://play-lh.googleusercontent.com/ZuMoNX6xiIBRwdtSL-FN0xCdXyahk8SRaPZ5_4HzkdQEp2Tm_GAsha9OcsRoSDgSw8Y=w240-h480-rw"},
  {name: "Clash Royale", url: "https://classroomlesson.github.io/basic-ruffle-player/html/clash_royale/index.html", img: "https://play-lh.googleusercontent.com/gnSC6s8-6Tjc4uhvDW7nfrSJxpbhllzYhgX8y374N1LYvWBStn2YhozS9XXaz1T_Pi2q"},
  {name: "Cookie Clicker", url: "https://reading.dinprima.ro/resources/semag/cookieclicker/index.html", img: "https://reading.dinprima.ro/resources/semag/cookieclicker/img/perfectCookie.png"},
  {name: "Tag", url: "https://script.google.com/macros/s/AKfycby2Crs4kcY3H8tDRHQp1JRJNd_v8_zYBjwU-qF2trfXQWAeWpW1vFVzGgQdv-Ejmq6P/exec", img: "https://math711.github.io/img/class-633.png"},
  {name: "Crossy Road", url: "https://studyschool.netlify.app/g/crossyroad/", img: "https://math711.github.io/img/class-402.png"},
  {name: "Crazy Cattle 3D", url: "https://crazycattle.club/", img: "https://img02.symbaloo.com/XPUEyvCMeHSBnj1zo3b3Dw6a9YE=/0x7:245x252/fit-in/522x342/filters:no_upscale()/smarkImages%2Fv1%2Fd1%2Fd5%2F1cbad2544788a399975998b6a3afd8fbb336704132e64cd00edee0355012.png"},
  {name: "Doodle Jump", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/doodle-jump/index.html", img: "https://reading.dinprima.ro/resources/semag/doodlejump/icon.png"},
  {name: "Draw The Hill", url: "https://element-games-v5.vercel.app/g/source/draw-the-hill/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTK8WYV2uyGpWXy2lKdzlsSWfdTCK9LcDs1ZQ&s"},
  {name: "Drift Boss", url: "https://script.google.com/macros/s/AKfycbwAOi2tPbjzeWDkigfZMIPEGubYxz2la_qjxJyydNZyjwgbqsv9mv05g7tdmLHdvdaw/exec", img: "http://cherrion.top/assets/img/games/driftboss.png"},
  {name: "Volley Random", url: "https://cherrion.top/stores/ucp-games/volleyrandom/", img: "https://cherrion.top/assets/img/games/volleyrandom.png"},
  {name: "Save My Pet", url: "https://script.google.com/macros/s/AKfycbzzzBlqpi-UH1EolZkm_TwyvFbgdV6fuWz_IjtPNgQ8ZhiPtGODuz0NvWvNlMUVWoeS/exec", img: "https://play-lh.googleusercontent.com/GmjNSIdVoTumy_mps_Ia5U7rpIcaYh_ixhWZlLCcLKCRNOOKop3fFF2fOtEHcNfrthIa"},
  {name: "Drive Mad", url: "https://reading.dinprima.ro/resources/semag/drivemad/index.html", img: "https://play-lh.googleusercontent.com/V_egAxch0phxs10H_Z1QpWRrsH4phd8egT_5ZjYlFbXzXvwpUGpmJMn2h6HgbGkSlZSM"},
  {name: "Fireboy & Watergirl", url: "https://rawcdn.githack.com/lioxryt/lioxryt-assets/d16b2cb691af033a5f3da3a496cb691c81977fc9/other/fbwg1/index.html", img: "https://reading.dinprima.ro/resources/semag/fireboywatergirl/icon.png"},
  {name: "Flappy Bird", url: "https://classroomlesson.github.io/basic-ruffle-player/html/flappy_bird/index.html", img: "https://upload.wikimedia.org/wikipedia/en/thumb/0/0a/Flappy_Bird_icon.png/250px-Flappy_Bird_icon.png"},
  {name: "Fruit Ninja", url: "https://reading.dinprima.ro/resources/semag/fruitninja/index.html", img: "https://math711.github.io/img/class-22.png"},
  {name: "Table Tennis World Tour", url: "https://g-mcb.github.io/public/assets/games/table-tennis-world-tour/", img: "https://g-mcb.github.io/public/assets/images/tabletennisworldtour.png"},
  {name: "Tomb Of The Mask", url: "https://a7k9-lq2d-v8r1-zx0c-mb6p-tn4g-wy3e-ju5h.github.io/AgicFiles183294-4/tomb/", img: "https://play-lh.googleusercontent.com/ATGr-U4JBK2VjFzKGK9eMMkrDxJaazadOUoz_7Yl0U5NrWSFcFUzEtNurWXYzVWc8uOO=w240-h480-rw"},
  {name: "Idle Mining Empire", url: "https://ubgwtf.gitlab.io/idle-mining-empire/", img: "https://unblocked-games.s3.amazonaws.com/media/posts/372/idle-mining-empire-512.jpg"},
  {name: "Snake MLG", url: "https://ph4xus.github.io/Vafor_IT/snakemlg/", img: "https://ph4xus.github.io/assets/img/snakemlg.jfif"},
  {name: "State.io", url: "https://ph4xus.github.io/Vafor_IT/state-io/", img: "https://ph4xus.github.io/assets/img/state-io.png"},
  {name: "Amaze", url: "https://ph4xus.github.io/Vafor_IT/amaze/", img: "https://ph4xus.github.io/assets/img/amaze.png"},
  {name: "Geometry Dash", url: "https://g-mcb.github.io/public/assets/games/geometry-dash/", img: "https://math711.github.io/img/class-453.png"},
  {name: "FNAF 3", url: "https://script.google.com/macros/s/AKfycbyVdPAG4aRGh5tmBwKEZthKmaqO12GTD-h-C1Do6ICbR3ZEj5ic1aJQ2e4Im2pxcWLf/exec", img: "https://cherrion.top/assets/img/games/fnaf3.png"},
  {name: "Getaway Shootout", url: "https://studyschool.netlify.app/g/getaway-shootout/", img: "https://reading.dinprima.ro/resources/semag/getawayshooter/Untitled.jpeg"},
  {name: "Helix Jump", url: "https://reading.dinprima.ro/resources/semag/helixjump/index.html", img: "https://play-lh.googleusercontent.com/e4Oq0lcZMGkoCTzl-J5HCahIED_9Q-nbBrMQ80MT3uEBf0gwDOh4EMEtkmdCr2Zsng"},
  {name: "Infinite Craft", url: "https://classroomlesson.github.io/basic-ruffle-player/html/nova_craft/index.html", img: "https://play-lh.googleusercontent.com/YJFHGSmrMGuUqyWZ0oZDgDtDErIU2jQY3yT_PG9IRL6s5dBLmKXrXQShM3n8HFoPhkM=w240-h480-rw"},
  {name: "Knife Hit", url: "https://reading.dinprima.ro/resources/semag/knifehit/index.html", img: "https://play-lh.googleusercontent.com/Xi15vMCqH2Ke5ndbpP86LAE2djl58hEpTZvnCF2sKUkd7C9D_x-cOGiR6HhsIOUS9Q"},
  {name: "Magic Tiles", url: "https://script.google.com/macros/s/AKfycbzsriooEqdtLu3zcG2AUjtLNeqgETUcTv5duzFgEKlIZAZZsYlq49sR2aN6nSwsAjcs/exec", img: "https://play-lh.googleusercontent.com/u94NKpNjH1sBOiKHevX3_ATM-ozNHg6b186oU9GfnPnHwbdJ7RaeipkCRcVPdf1KRA"},
  {name: "Swerve", url: "https://s3-eu-west-1.amazonaws.com/apps.playcanvas.com/VecAxR3e/index.html", img: "https://play-lh.googleusercontent.com/P308WGnDs89S9N4QKatc20TBa_vc72evFwg5n8dsNpDNbCKzb4IGm9i2vLBpKex50gY=w600-h300-pc0xffffff-pd"},
  {name: "Minecraft 1.12.2", url: "https://element-games-v5.vercel.app/g/source/minecraft-1.12/index.html", img: "https://images.icon-icons.com/2699/PNG/512/minecraft_logo_icon_168974.png"},
  {name: "Monkey Mart", url: "https://studyschool.netlify.app/g/monkey-mart", img: "https://reading.dinprima.ro/resources/semag/monkeymart/unnamed.png"},
  {name: "Moto X3M", url: "https://reading.dinprima.ro/resources/semag/motox3m/index.html", img: "https://reading.dinprima.ro/resources/semag/motox3m/splash.jpg"},
  {name: "Obby on a Bike", url: "https://element-games-v5.vercel.app/g/source/obby-on-a-bike/index.html", img: "https://play-lh.googleusercontent.com/YwxYsY3FW_zhGTZuYjT9MOpv48FKKl90uyM4eyqOjVCPLEbosk2NALJc64arXdPhjq7d"},
  {name: "Climb Simulator", url: "https://script.google.com/macros/s/AKfycbzUPEYWyiXAsI-wbbg-NbWW6ZAZF1FlSqACKLaEQMvPbnqP5zeGHck2VpwfJ9yoO3o7/exec", img: "https://play-lh.googleusercontent.com/BAVIJZwYbS5R02NnvzKGl4Y2xJfUnX0EzrEwwEbnxBMty44EFqTZRFgDRuHLeLZ7NvEE5pC0iBKKeHe44pEyGQ"},
  {name: "Pacman", url: "https://element-games-v5.vercel.app/g/source/pacman/index.html", img: "https://reading.dinprima.ro/resources/semag/pacman/icon.png"},
  {name: "Papa Louie", url: "https://script.google.com/macros/s/AKfycbyR3khxh-b0yaOgR_d-BqnPEHVrv4kRYteyWOCHT_u-ekBD_d5nMIM-3EK0Pd0e2aGe/exec", img: "https://img.poki-cdn.com/cdn-cgi/image/q=78,scq=50,width=1200,height=1200,fit=cover,f=png/f54dee3512ad75e89cc256c6bec22f06/papa-louie-when-pizzas-attack.jpeg"},
  {name: "Papa Louie 2", url: "https://script.google.com/macros/s/AKfycby4Ye7CbYCL3GzlZxZgtpIlt9Uv5RYUeHNKj8O9sg55h9hXZrtPiS58EVb4F32GpgnS/exec", img: "https://reading.dinprima.ro/resources/semag/papalouie2/logo.png"},
  {name: "Grow with Every Step", url: "https://script.google.com/macros/s/AKfycbydRKNRXuNyKIjoTMQ752kjgz5HGJpQ8j-cX-t2Ejum9YP_QVQ53Ar5YPywdob_XJk0/exec", img: "https://i.imgur.com/eJwQ4Iv.png"}, 
  {name: "Ballistic Chickens", url: "https://player-nation.anjumanallana.in/resources/semag/ballisticchickens/index.html", img: "https://reading.dinprima.ro/resources/semag/ballisticchickens/logo.png"},
  {name: "Tap Tap Shots", url: "https://unblocked-games.s3.amazonaws.com/games/2023/q/1/tap-tap-shots/index.html", img: "https://unblocked-games.s3.amazonaws.com/media/posts/406/responsive/tap-tap-shots-512-xs.jpg"}, 
  {name: "Yandere Simulator", url: "https://reading.dinprima.ro/resources/semag/yandere-simulator/index.html", img: "https://reading.dinprima.ro/resources/semag/yandere-simulator/logo.png"},
  {name: "Papa Louie 3", url: "https://script.google.com/macros/s/AKfycbzbrDYt2vNFxtv_BluWd3wHs0IcDt7chTXESLmT4UimQrfD1fjPwDmEKKomEWw74cXpqA/exec", img: "https://img.poki-cdn.com/cdn-cgi/image/q=78,scq=50,width=1200,height=1200,fit=cover,f=png/6e885a340550b9f7985deccc952db551/papa-louie-3.png"},
  {name: "Papa's Burgeria", url: "https://reading.dinprima.ro/resources/semag/papasburgeria/index.html", img: "https://reading.dinprima.ro/resources/semag/papasburgeria/images.jpeg"},
  {name: "Papa's Freezeria", url: "https://reading.dinprima.ro/resources/semag/papasfreezeria/index.html", img: "https://reading.dinprima.ro/resources/semag/papasfreezeria/images.jpeg"},
  {name: "Papa's Hotdoggeria", url: "https://reading.dinprima.ro/resources/semag/papashotdogeria/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS-KwpYmG_9veRHvvfU1xSLP9V5Z4-NG0YUNZG0rXbGvQ&s=10"},
  {name: "Papa's Pancakeria", url: "https://reading.dinprima.ro/resources/semag/papaspancakeria/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRK2yYV4W35JF3qhAMf1PWW5u04eSCR976E6LaN5-xTAQ&s=10"},
  {name: "Papa's Pastaria", url: "https://reading.dinprima.ro/resources/semag/papaspastaria/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTMQlO58zj9CDs3IQMyIWq9S4qtFMAzmGARfONOsLKQjw&s=10"},
  {name: "Papa's Pizzeria", url: "https://reading.dinprima.ro/resources/semag/papaspizzeria/index.html", img: "https://reading.dinprima.ro/resources/semag/papaspizzeria/images.jpeg"},
  {name: "Papa's Sushiria", url: "https://reading.dinprima.ro/resources/semag/papassushiria/index.html", img: "https://www.culinaryschools.org/kids-games/papas-sushiria/papas-sushiria.jpg"},
  {name: "Papa's Tacomia", url: "https://reading.dinprima.ro/resources/semag/papastacomia/index.html", img: "https://reading.dinprima.ro/resources/semag/papastacomia/papastacomia.png"},
  {name: "Papa's Wingeria", url: "https://reading.dinprima.ro/resources/semag/papaswingeria/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZfK-B1alJVGqZQjFz__cCTuc4dn_ofLTJG8PpMDBjhw&s=10"},
  {name: "Paper.io 2", url: "https://games.proll.dev/g/paperio2/", img: "https://math711.github.io/img/class-505.png"},
  {name: "Football Bros", url: "https://classroomlesson.github.io/basic-ruffle-player/html/football_bros/index.html", img: "https://project-s0lace.onrender.com/thumbs/football-bros.jpeg"},
  {name: "Rise Higher", url: "https://reading.dinprima.ro/resources/semag/risehigher/index.html", img: "https://images.hellokids.com/_uploads/_tiny_galerie/20190624/vign-rise-higher-hk-eyc_424.jpg"},
  {name: "Roblox Obby", url: "https://script.google.com/macros/s/AKfycbx-uaFWRwY1q4Gv7pRrd9PR3zbbmsKV5PTGPQZ11-u3EWCiD4xeM2V3_1JBvmJQNxSshw/exec", img: "https://play-lh.googleusercontent.com/KAz3HyTAVv6kKFVIdDKoHtp0_QsfVfzozrbt8p-iSE6SHTVJikcXtPtYDDN3yqk4LjKJHCWO9UdBQn0QeYw4"},
  {name: "Retro Bowl", url: "https://games.proll.dev/g/retro-bowl/", img: "https://reading.dinprima.ro/resources/semag/retrobowl/img/icon.jpg"},
  {name: "Retro Bowl College", url: "https://classroomlesson.github.io/basic-ruffle-player/html/retro_bowl_college/index.html", img: "https://img.poki-cdn.com/cdn-cgi/image/quality=78,width=314,height=314,fit=cover,f=auto/d98547374c4129bf441b754d495e41aa.png"},
  {name: "Idle Startup Tycoon", url: "https://g-mcb.github.io/public/assets/games/idle-startup-tycoon/", img: "https://g-mcb.github.io/public/assets/images/idlestartuptycoon.png"},
  {name: "Slope", url: "https://raw.githack.com/skoolgq/Polaris-Assets/main/slope/index.html", img: "https://reading.dinprima.ro/resources/semag/slope/slope4.jpeg"},
  {name: "Stack", url: "https://reading.dinprima.ro/resources/semag/stack/index.html", img: "https://childrenandmedia.org.au/assets/images/app-reviews/Stack.png"},
  {name: "Bridge Race", url: "https://classroomlesson.github.io/basic-ruffle-player/html/bridge_race/index.html", img: "https://play-lh.googleusercontent.com/ym7hOY7sjtsuZ-CR2tmvtsNEgPTkufUPKdaUKcNHOvJS3bf7CIxA7Eyc23FbnzziPsc"},
  {name: "Stickman Hook", url: "https://element-games-v5.vercel.app/g/source/stickman-hook/index.html", img: "https://play-lh.googleusercontent.com/yXqBI1Vb1b-xjwmXLE2T7FQbgHIxfvjze1b6jO2aLHfy8Y8ta7NFSEVqZoPHtM2Ajyrl"},
  {name: "Subway Surfers", url: "https://studyschool.netlify.app/g/subway-surfers/", img: "https://play-lh.googleusercontent.com/MmT3Av6CUMJGTthbYPt7dud3SotZ7ExEwkwy7bxNKn9_VbcsPgQ5Gl4gnni3P30rDKoA=w240-h480-rw"},
  {name: "The Impossible Quiz", url: "https://classroomlesson.github.io/basic-ruffle-player/html/theimpossiblequiz/index.html", img: "https://math711.github.io/img/class-480.png"},
  {name: "Time Shooter 2", url: "https://element-games-v5.vercel.app/g/source/time-shooter-2/index.html", img: "https://img.gamedistribution.com/62a72f2da7cb4b609579a47653546e6a-512x512.jpeg"},
  {name: "Time Shooter 3", url: "https://element-games-v5.vercel.app/g/source/time-shooter-3/index.html", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRQUFhypuMj6cRanchYLs25DH9EUy5gOe74-g&s"},
  {name: "Tiny Fishing", url: "https://studyschool.netlify.app/g/tinyfishing/", img: "https://math711.github.io/img/class-451.png"},
  {name: "Wordle Unlimited", url: "https://element-games-v5.vercel.app/g/source/wordle/index.html#daily", img: "https://static01.nyt.com/images/2022/03/02/crosswords/alpha-wordle-icon-new/alpha-wordle-icon-new-smallSquare252-v3.png?format=pjpg&quality=75&auto=webp&disable=upscale"},
  {name: "YoHoHo!", url: "https://reading.dinprima.ro/resources/semag/yohoho/index.html", img: "https://math711.github.io/img/class-828.png"}
];

defaultGames.sort((a, b) => {
  const nameA = a.name.toUpperCase();
  const nameB = b.name.toUpperCase();

  if (nameA < nameB) return -1;
  if (nameA > nameB) return 1;
  return 0;
});

const notWorking = [
];

const multiGames = [
  {name: "Basket Random", url: "https://classroomlesson.github.io/basic-ruffle-player/html/basket_random/index.html"},
  {name: "Boxing Random", url: "https://element-games-v5.vercel.app/g/source/boxing-random/index.html"},
  {name: "Tag", url: "https://script.google.com/macros/s/AKfycby2Crs4kcY3H8tDRHQp1JRJNd_v8_zYBjwU-qF2trfXQWAeWpW1vFVzGgQdv-Ejmq6P/exec"},  
  {name: "Fireboy & Watergirl", url: "https://seraph-bi6hosts.vercel.app/games/fireboywatergirl/index.html"},
  {name: "Getaway Shootout", url: "https://studyschool.netlify.app/g/getaway-shootout/"},
  {name: "Minecraft 1.12.2", url: "https://element-games-v5.vercel.app/g/source/minecraft-1.12/index.html"},
  {name: "Retro Bowl", url: "https://studyschool.netlify.app/g/retro-bowl/"},
  {name: "Football Bros", url: "https://classroomlesson.github.io/basic-ruffle-player/html/football_bros/index.html"},
];

multiGames.sort((a, b) => {
  const nameA = a.name.toUpperCase();
  const nameB = b.name.toUpperCase();

  if (nameA < nameB) return -1;
  if (nameA > nameB) return 1;
  return 0;
});

const puzzleGames = [
  {name: "2048", url: "https://classroomlesson.github.io/basic-ruffle-player/html/2048/index.html"},
  {name: "Block Blast", url: "https://classroomlesson.github.io/basic-ruffle-player/html/blocky_puzzle/index.html"},
  {name: "Bloxors", url: "https://seraph-bi6hosts.vercel.app/games/bloxors/index.html"},
  {name: "Save My Pet", url: "https://script.google.com/macros/s/AKfycbzzzBlqpi-UH1EolZkm_TwyvFbgdV6fuWz_IjtPNgQ8ZhiPtGODuz0NvWvNlMUVWoeS/exec"},
  {name: "Fireboy & Watergirl", url: "https://seraph-bi6hosts.vercel.app/games/fireboywatergirl/index.html"},
  {name: "Stack", url: "https://seraph-bi6hosts.vercel.app/games/stack/index.html"},
  {name: "The Impossible Quiz", url: "https://seraph-bi6hosts.vercel.app/games/theimpossiblequiz/index.html"},
  {name: "Wordle Unlimited", url: "https://element-games-v5.vercel.app/g/source/wordle/index.html#daily"},
];

puzzleGames.sort((a, b) => {
  const nameA = a.name.toUpperCase();
  const nameB = b.name.toUpperCase();

  if (nameA < nameB) return -1;
  if (nameA > nameB) return 1;
  return 0;
});

const obbyGames = [
  {name: "Obby on a Bike", url: "https://element-games-v5.vercel.app/g/source/obby-on-a-bike/index.html"},
  {name: "Roblox Obby", url: "https://script.google.com/macros/s/AKfycbx-uaFWRwY1q4Gv7pRrd9PR3zbbmsKV5PTGPQZ11-u3EWCiD4xeM2V3_1JBvmJQNxSshw/exec"},
];

const sportsGames = [
  {name: "Retro Bowl", url: "https://studyschool.netlify.app/g/retro-bowl/"},
  {name: "Retro Bowl College", url: "https://classroomlesson.github.io/basic-ruffle-player/html/retro_bowl_college/index.html"},
  {name: "Basket Bros", url: "https://player-nation.anjumanallana.in/resources/semag/basketbros/index.html"},
  {name: "Basketball Stars", url: "https://reading.dinprima.ro/resources/semag/basketball-stars/index.html"},
  {name: "Football Bros", url: "https://classroomlesson.github.io/basic-ruffle-player/html/football_bros/index.html"},
  {name: "Basket Random", url: "https://classroomlesson.github.io/basic-ruffle-player/html/basket_random/index.html"},
  {name: "Boxing Random", url: "https://element-games-v5.vercel.app/g/source/boxing-random/index.html"},
  {name: "Volley Random", url: "https://cherrion.top/stores/ucp-games/volleyrandom/"},
  {name: "Backyard Baseball", url: "https://script.google.com/macros/s/AKfycbxCGoMs4wmjd_c08SeWaKuJKh9BoQlovbZIbPtzK03OLOQ6CmmImR9s6HpsxCtaHYbi/exec"},
  {name: "Backyard Basketball", url: "https://script.google.com/macros/s/AKfycbzutG_IKsHOQPExLK1OU1gKUy0FzeES71P13XgouwmJWvJaDi8U26ivFGRD_IHuFIDJ/exec"},
  {name: "Tap Tap Shots", url: "https://unblocked-games.s3.amazonaws.com/games/2023/q/1/tap-tap-shots/index.html"},
  {name: "Table Tennis World Tour", url: "https://_github-production.tickles.store/s/g/load/table-tennis-world-tour/index.html"},
];

sportsGames.sort((a, b) => {
  const nameA = a.name.toUpperCase();
  const nameB = b.name.toUpperCase();

  if (nameA < nameB) return -1;
  if (nameA > nameB) return 1;
  return 0;
});

obbyGames.sort((a, b) => {
  const nameA = a.name.toUpperCase();
  const nameB = b.name.toUpperCase();

  if (nameA < nameB) return -1;
  if (nameA > nameB) return 1;
  return 0;
});

const quotes = [
  "Stealth isn‚Äôt hiding. It‚Äôs blending in.",
  "Not sure where to start? Try a random game.",
  "You can‚Äôt block what you can‚Äôt detect.",
  "Freedom starts with a tab.",
  "Kuppy is watching you‚Ä¶ but in a friendly way.",
  "KuppyCloaker is better enjoyed with friends.",
  "I told my computer a joke. It laughed in binary.",
  "Remember: Every button has consequences.",
  "This isn‚Äôt a bug. It‚Äôs a feature.",
  "If this page was a sandwich, it‚Äôd be extra cheesy.",
  "KuppyCloaker: Making procrastination look productive.",
  "Click responsibly. Or don‚Äôt. Whatever.",
  "Somebody call tech support. Or maybe not.",
  "Your Wi-Fi secretly judges you.",
  "Clicking random things builds character.",
  "Click here‚Ä¶ actually don‚Äôt, maybe.",
  "This page self-destructs in 3‚Ä¶ 2‚Ä¶ just kidding.",
  "Don‚Äôt ask me how this works. I don‚Äôt know either.",
  "Don‚Äôt read this aloud. Unless you want to.",
  "Kuppy believes in you. Mostly.",
  "Fun fact: This page contains 0 calories.",
  "Smiles are contagious. So are pop-ups.",
  "Do not try to hack this‚Ä¶ unless you‚Äôre me.",
  "Cloak smart. Play smarter.",
  "The web, unfiltered.",
  "No limits, no traces, no problem."
];

const quoteEl = document.getElementById("welcomeSubtext");
quoteEl.textContent = quotes[Math.floor(Math.random() * quotes.length)];
quoteEl.style.animation = 'fadeInScale 0.8s ease-out 0.3s both';

const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

class Particle {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.size = Math.random() * 3 + 1;
    this.speedX = Math.random() * 0.5 - 0.25;
    this.speedY = Math.random() * 0.5 - 0.25;
    this.opacity = Math.random() * 0.5 + 0.2;
  }
  
  update() {
    this.x += this.speedX;
    this.y += this.speedY;
    
    if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
    if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
  }
  
  draw() {
    ctx.fillStyle = `rgba(147, 163, 184, ${this.opacity})`;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fill();
  }
}

const particles = [];
for (let i = 0; i < 80; i++) {
  particles.push(new Particle());
}

const trail = [];
const trailLength = 8;

document.addEventListener('mousemove', (e) => {
  trail.push({ x: e.clientX, y: e.clientY, time: Date.now() });
  
  if (trail.length > trailLength) {
    trail.shift();
  }
});

function drawCursorTrail() {
  const now = Date.now();
  
  trail.forEach((point, index) => {
    const age = now - point.time;
    if (age < 500) {
      const opacity = (1 - age / 500) * 0.3;
      const size = 3 - (age / 500) * 2;
      
      ctx.fillStyle = `rgba(0, 123, 255, ${opacity})`;
      ctx.beginPath();
      ctx.arc(point.x, point.y, size, 0, Math.PI * 2);
      ctx.fill();
    }
  });
}

function animateParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  particles.forEach(particle => {
    particle.update();
    particle.draw();
  });
  
  drawCursorTrail();
  
  requestAnimationFrame(animateParticles);
}

animateParticles();

window.addEventListener('load',()=>{
  document.body.classList.add('loaded');

  const savedTabName = localStorage.getItem('kuppyTabName');
  if(savedTabName) document.title = savedTabName;

  const savedTheme = JSON.parse(localStorage.getItem('kuppyTheme')) || {accent:'#007bff', bg:'#0f1724', card:'#0b1220'};
  const isLight = localStorage.getItem('kuppyLightMode') === 'true';

  document.documentElement.style.setProperty('--accent', savedTheme.accent);
  document.documentElement.style.setProperty('--bg', isLight ? lighten(savedTheme.bg) : savedTheme.bg);
  document.documentElement.style.setProperty('--card', isLight ? lighten(savedTheme.card) : savedTheme.card);
  document.documentElement.style.setProperty('--text', isLight ? '#111' : '#e6eef8');

  if(isLight) document.body.classList.add('light');
});

const text="KuppyCloaker"; let i=0;

function startTyping(){document.getElementById("typedTitle").textContent=""; typeTitle();}

function typeTitle(){if(i<text.length){document.getElementById("typedTitle").textContent+=text.charAt(i);i++;setTimeout(typeTitle,120);}}

function lighten(hex){
  const c = parseInt(hex.slice(1),16);
  const r = Math.min(255, ((c>>16)+51));
  const g = Math.min(255, (((c>>8)&0x00FF)+51));
  const b = Math.min(255, ((c&0x0000FF)+51));
  return `rgb(${r},${g},${b})`;
}

function openWebsite(url) {
  if (!url) return;
  if (!url.startsWith('http')) url = 'https://' + url;

  const overlay = document.getElementById('fadeOverlay');
  overlay.classList.add('active');

  setTimeout(() => {
    const win = window.open('', '_blank');
    win.document.write(`
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name='referrer' content='no-referrer'>
  <title>New Tab</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: black;
    }

    embed {
      width: 100%;
      height: 100%;
      border: none;
    }

    #backBtn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(0,0,0,0.6);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      font-family: system-ui, sans-serif;
      transition: background 0.2s;
    }

    #backBtn:hover {
      background: rgba(255,255,255,0.2);
    }

    #fadeOverlay {
      position: fixed;
      inset: 0;
      background: black;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s ease;
      z-index: 2000;
    }

    #fadeOverlay.active {
      opacity: 1;
    }
  </style>
</head>
<body>
  <button id="backBtn">‚¨Ö</button>
  <div id="fadeOverlay"></div>
  <embed src='${url}'></embed>

<script>
  const backBtn = document.getElementById('backBtn');
  const fadeOverlay = document.getElementById('fadeOverlay');

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      fadeOverlay.classList.add('active');
      setTimeout(() => {
        window.close();
      }, 1);
    }
  });

  backBtn.onclick = () => {
    fadeOverlay.classList.add('active');
    setTimeout(() => {
      window.close();
    }, 600);
  };
  <\/script>
</body>
</html>
`);
overlay.classList.remove('active');
}, 500);
}

function rememberRecentGame(game) {
  localStorage.setItem('recentGame', JSON.stringify(game));
}

function createGameCard(g, idx, savedArray, starredArray, categoryLength, reloadFn) {
  const div = document.createElement('div');
  div.className = 'card';

  const imgSrc = g.img || (defaultGames.find(d => d.name === g.name) || {}).img || null;
  if (imgSrc) {
    const img = document.createElement('img');
    img.src = imgSrc;
    img.alt = g.name;
    img.style.borderRadius = 'inherit';
    img.onerror = () => {
      img.style.display = 'none';
      div.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02))';
    };
    div.appendChild(img);
  }

  const overlay = document.createElement('div');
  overlay.className = 'card-title';
  overlay.textContent = g.name;
  overlay.style.pointerEvents = 'none';
  div.appendChild(overlay);

  const starBtn = document.createElement('button');
  starBtn.className = 'starBtn';
  if (starredArray && starredArray.includes(g.name)) starBtn.classList.add('starred');
  starBtn.innerHTML = '‚òÖ';
  starBtn.onclick = (e) => {
  e.stopPropagation();
  let s = JSON.parse(localStorage.getItem('starredGames') || '[]');
  if (s.includes(g.name)) {
    s = s.filter(x => x !== g.name);
    starBtn.classList.remove('starred');
  } else {
    s.push(g.name);
    starBtn.classList.add('starred');
  }
  localStorage.setItem('starredGames', JSON.stringify(s));
  
  KuppyState.stats.favorites = s.length;
  saveStats();
  checkAchievements();
  
  displayStarredGames();
  if (typeof reloadFn === 'function') reloadFn();
};
  div.appendChild(starBtn);

  if (typeof categoryLength === 'number' && idx >= categoryLength) {
    const del = document.createElement('button');
    del.className = 'deleteBtn';
    del.textContent = '‚ùå';
    del.onclick = (e) => {
      e.stopPropagation();
      const updated = (savedArray || []).filter(x => x.name !== g.name);
      localStorage.setItem('customPresets', JSON.stringify(updated));
      if (typeof reloadFn === 'function') reloadFn();
    };
    div.appendChild(del);
  }

  div.onclick = () => openWebsite(g.url);

  return div;
}

function displayStarredGames() {
  const container = document.getElementById('starredGamesContainer');
  container.innerHTML = '';
  
  const starred = JSON.parse(localStorage.getItem('starredGames') || '[]');
  if (starred.length === 0) return;
  
  const saved = JSON.parse(localStorage.getItem('customPresets') || '[]');
  const allGames = [...defaultGames, ...saved];
  
  const starredGames = allGames.filter(g => starred.includes(g.name));
  
  const savedPositions = JSON.parse(localStorage.getItem('starredGamePositions') || '{}');
  
  const defaultPositions = [
    { top: '10%', left: '2%' },
    { top: '30%', left: '2%' },
    { top: '50%', left: '2%' },
    { top: '70%', left: '2%' },
    { top: '10%', right: '2%' },
    { top: '30%', right: '2%' },
    { top: '50%', right: '2%' },
    { top: '70%', right: '2%' },
  ];
  
  starredGames.forEach((game, idx) => {
    const icon = document.createElement('div');
    icon.className = 'starred-game-icon';
    icon.dataset.gameName = game.name;
    
    const imgSrc = game.img || (defaultGames.find(d => d.name === game.name) || {}).img;
    if (imgSrc) {
      const img = document.createElement('img');
      img.src = imgSrc;
      img.alt = game.name;
      img.draggable = false;
      icon.appendChild(img);
    }
    
    const savedPos = savedPositions[game.name];
    if (savedPos) {
      icon.style.left = savedPos.left;
      icon.style.top = savedPos.top;
      icon.style.right = 'auto';
      icon.style.bottom = 'auto';
    } else if (idx < defaultPositions.length) {
      Object.assign(icon.style, defaultPositions[idx]);
    }
    
    icon.style.animationDelay = `${idx * 0.1}s`;
    
    makeDraggable(icon, game);
    
    container.appendChild(icon);
  });
}

function makeDraggable(element, game) {
  let isDragging = false;
  let startX, startY, initialLeft, initialTop;
  let hasMoved = false;
  
  element.addEventListener('mousedown', (e) => {
    isDragging = true;
    hasMoved = false;
    element.classList.add('dragging');
    
    const rect = element.getBoundingClientRect();
    startX = e.clientX;
    startY = e.clientY;
    initialLeft = rect.left;
    initialTop = rect.top;
    
    element.style.right = 'auto';
    element.style.bottom = 'auto';
    element.style.left = initialLeft + 'px';
    element.style.top = initialTop + 'px';
    
    e.preventDefault();
  });
  
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    
    if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
      hasMoved = true;
    }
    
    const newLeft = initialLeft + deltaX;
    const newTop = initialTop + deltaY;
    const maxLeft = window.innerWidth - element.offsetWidth;
    const maxTop = window.innerHeight - element.offsetHeight;
    
    element.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + 'px';
    element.style.top = Math.max(0, Math.min(newTop, maxTop)) + 'px';
  });
  
  document.addEventListener('mouseup', (e) => {
    if (!isDragging) return;
    
    isDragging = false;
    element.classList.remove('dragging');
    
    if (!hasMoved) {
      openWebsite(game.url);
      rememberRecentGame(game);
    } else {
      const savedPositions = JSON.parse(localStorage.getItem('starredGamePositions') || '{}');
      savedPositions[game.name] = {
        left: element.style.left,
        top: element.style.top
      };
      localStorage.setItem('starredGamePositions', JSON.stringify(savedPositions));
    }
  });
}

document.getElementById('randomGameBtn').onclick = () => {
  const saved = JSON.parse(localStorage.getItem('customPresets') || '[]');
  const allGames = [...defaultGames, ...saved];
  if (allGames.length === 0) return alert('No games available!');
  const randomGame = allGames[Math.floor(Math.random() * allGames.length)];
  openWebsite(randomGame.url);
  rememberRecentGame(randomGame);
};

document.getElementById('recentGamesBtn').onclick = () => {
  const recent = JSON.parse(localStorage.getItem('recentGame'));
  if (!recent) return alert('No recent game yet!');
  openWebsite(recent.url);
};

function loadGamesPage(){
  const grid=document.getElementById('allGamesGrid');
  grid.innerHTML='';
  const saved=JSON.parse(localStorage.getItem('customPresets')||'[]');
  const starred=JSON.parse(localStorage.getItem('starredGames')||'[]');
  const allGames = [...defaultGames,...saved];

  allGames.sort((a,b)=>{
    const aStar=starred.includes(a.name);
    const bStar=starred.includes(b.name);
    if(aStar && !bStar) return -1;
    if(!aStar && bStar) return 1;
    return 0;
  });

  allGames.forEach((g, idx) => {
    const card = createGameCard(g, idx, saved, starred, defaultGames.length, loadGamesPage);
    grid.appendChild(card);
  });
}

function loadpuzzleGamesPage(){
  const grid=document.getElementById('puzzleGamesGrid');
  grid.innerHTML='';
  const saved=JSON.parse(localStorage.getItem('customPresets')||'[]');
  const starred=JSON.parse(localStorage.getItem('starredGames')||'[]');
  const allGames = [...puzzleGames,...saved];

  allGames.sort((a,b)=>{
    const aStar=starred.includes(a.name);
    const bStar=starred.includes(b.name);
    if(aStar && !bStar) return -1;
    if(!aStar && bStar) return 1;
    return 0;
  });

  allGames.forEach((g, idx) => {
    const card = createGameCard(g, idx, saved, starred, puzzleGames.length, loadpuzzleGamesPage);
    grid.appendChild(card);
  });
}

function loadobbyGamesPage(){
  const grid=document.getElementById('obbyGamesGrid');
  grid.innerHTML='';
  const saved=JSON.parse(localStorage.getItem('customPresets')||'[]');
  const starred=JSON.parse(localStorage.getItem('starredGames')||'[]');
  const allGames = [...obbyGames,...saved];

  allGames.sort((a,b)=>{
    const aStar=starred.includes(a.name);
    const bStar=starred.includes(b.name);
    if(aStar && !bStar) return -1;
    if(!aStar && bStar) return 1;
    return 0;
  });

  allGames.forEach((g, idx) => {
    const card = createGameCard(g, idx, saved, starred, obbyGames.length, loadobbyGamesPage);
    grid.appendChild(card);
  });
}

function loadsportsGamesPage(){
  const grid=document.getElementById('sportsGamesGrid');
  grid.innerHTML='';
  const saved=JSON.parse(localStorage.getItem('customPresets')||'[]');
  const starred=JSON.parse(localStorage.getItem('starredGames')||'[]');
  const allGames = [...sportsGames,...saved];

  allGames.sort((a,b)=>{
    const aStar=starred.includes(a.name);
    const bStar=starred.includes(b.name);
    if(aStar && !bStar) return -1;
    if(!aStar && bStar) return 1;
    return 0;
  });

  allGames.forEach((g, idx) => {
    const card = createGameCard(g, idx, saved, starred, sportsGames.length, loadsportsGamesPage);
    grid.appendChild(card);
  });
}

function loadmultiGamesPage(){
  const grid=document.getElementById('multiGamesGrid');
  grid.innerHTML='';
  const saved=JSON.parse(localStorage.getItem('customPresets')||'[]');
  const starred=JSON.parse(localStorage.getItem('starredGames')||'[]');
  const allGames = [...multiGames,...saved];

  allGames.sort((a,b)=>{
    const aStar=starred.includes(a.name);
    const bStar=starred.includes(b.name);
    if(aStar && !bStar) return -1;
    if(!aStar && bStar) return 1;
    return 0;
  });

  allGames.forEach((g, idx) => {
    const card = createGameCard(g, idx, saved, starred, multiGames.length, loadmultiGamesPage);
    grid.appendChild(card);
  });
}

function showGamesPage(){
  const home=document.getElementById('homePage');
  const games=document.getElementById('gamesPage');
  const multi=document.getElementById('multigamesPage');
  const puzzle=document.getElementById('puzzlegamesPage');
  const obby=document.getElementById('obbygamesPage');
  home.style.opacity='1';
  games.style.display='flex';
  multi.style.display='1';
  document.getElementById('infoShell').style.display = 'none';
  puzzle.style.display='1';
  obby.style.display='1';
  requestAnimationFrame(()=>{
    home.style.transition='opacity 0.5s';
    home.style.opacity='0';
    setTimeout(()=>{
      home.style.display='none';
      games.classList.add('show');
      loadGamesPage();
    },500);
  });
}

function showMultiGamesPage(){
  const home=document.getElementById('homePage');
  const games=document.getElementById('gamesPage');
  const multi=document.getElementById('multigamesPage');
  const puzzle=document.getElementById('puzzlegamesPage');
  const obby=document.getElementById('obbygamesPage');
  home.style.opacity='1';
  games.style.display='1';
  multi.style.display='flex';
  document.getElementById('infoShell').style.display = 'none';
  puzzle.style.display='1';
  obby.style.display='1';
  requestAnimationFrame(()=>{
    home.style.transition='opacity 0.5s';
    home.style.opacity='0';
    setTimeout(()=>{
      home.style.display='none';
      multi.classList.add('show');
      loadmultiGamesPage();
    },500);
  });
}

function showPuzzleGamesPage(){
  const home=document.getElementById('homePage');
  const games=document.getElementById('gamesPage');
  const multi=document.getElementById('multigamesPage');
  const puzzle=document.getElementById('puzzlegamesPage');
  const obby=document.getElementById('obbygamesPage');
  home.style.opacity='1';
  games.style.display='1';
  multi.style.display='1';
  document.getElementById('infoShell').style.display = 'none';
  puzzle.style.display='flex';
  obby.style.display='1';
  requestAnimationFrame(()=>{
    home.style.transition='opacity 0.5s';
    home.style.opacity='0';
    setTimeout(()=>{
      home.style.display='none';
      puzzle.classList.add('show');
      loadpuzzleGamesPage();
    },500);
  });
}

function showObbyGamesPage(){
  const home=document.getElementById('homePage');
  const games=document.getElementById('gamesPage');
  const multi=document.getElementById('multigamesPage');
  const puzzle=document.getElementById('puzzlegamesPage');
  const obby=document.getElementById('obbygamesPage');
  const sports=document.getElementById('sportsgamesPage');
  home.style.opacity='1';
  games.style.display='1';
  multi.style.display='1';
  document.getElementById('infoShell').style.display = 'none';
  puzzle.style.display='1';
  sports.style.display='1';
  obby.style.display='flex';
  requestAnimationFrame(()=>{
    home.style.transition='opacity 0.5s';
    home.style.opacity='0';
    setTimeout(()=>{
      home.style.display='none';
      obby.classList.add('show');
      loadobbyGamesPage();
    },500);
  });
}

function showHomePage(){
  const home=document.getElementById('homePage');
  const games=document.getElementById('gamesPage');
  const multi=document.getElementById('multigamesPage');
  const puzzle=document.getElementById('puzzlegamesPage');
  const obby=document.getElementById('obbygamesPage');
  const sports=document.getElementById('sportsgamesPage');
  games.classList.remove('show');
  multi.classList.remove('show');
  puzzle.classList.remove('show');
  
  const weatherEnabled = localStorage.getItem('kuppyWeatherEnabled') === 'true';
  document.getElementById('infoShell').style.display = weatherEnabled ? 'flex' : 'none';
  
  obby.classList.remove('show');
  sports.classList.remove('show');
  setTimeout(()=>{
    games.style.display='none';
    multi.style.display='none';
    puzzle.style.display='none';
    obby.style.display='none';
    sports.style.display='none';
    home.style.display='block';
    requestAnimationFrame(()=>{
      home.style.opacity='1';
      displayStarredGames();
    });
  },500);
}

document.getElementById('websiteInput').addEventListener('keydown', (event) => {
  if (event.key === 'Enter') {
    const url = document.getElementById('websiteInput').value.trim();
    openWebsite(url);
  }
});

const kuppycloakermaincoins = "13ad0b87d0b5d5b6e00564fdc589c6d33cbaf0acaf72aea144feff851c3e3c8a";
const kuppycloakercoins ="693cf0cf044bea170fb9a015c44a2a0b3209ac623d56a03d727ee70d5ae88ceb";

async function hashCode(code) {
  const encoder = new TextEncoder();
  const data = encoder.encode(code);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

async function handleLogin() {
  const username = loginUsername.value.trim();
  const code = loginPassword.value.trim();

  if (!username || !code) {
    loginMsg.textContent = "Enter username & access code";
    return;
  }

  const enteredHash = await hashCode(code);
  
  if (enteredHash !== kuppycloakercoins) {
    loginMsg.textContent = "Invalid access code";
    return;
  }

  localStorage.setItem('kuppyTrusted', 'true');
  localStorage.setItem('kuppyAutoUser', username);

  loginShell.classList.add('hidden');
  setTimeout(() => {
    loginShell.style.display = 'none';
    const weatherEnabled = localStorage.getItem('kuppyWeatherEnabled') === 'true';
    document.getElementById('infoShell').style.display = weatherEnabled ? 'flex' : 'none';
    homePage.style.display = 'block';
    setTimeout(() => {
      homePage.classList.remove('hidden');
      startTyping();
    }, 10);
    userDisplay.textContent = username;
    displayStarredGames();
  }, 500);
}

document.getElementById('loginPassword').addEventListener('keydown', (event) => {
  if (event.key === 'Enter') {
    handleLogin();
  }
});

document.getElementById('allGamesBtn').onclick=showGamesPage;
document.getElementById('multiGamesBtn').onclick=showMultiGamesPage;
document.getElementById('puzzleGamesBtn').onclick=showPuzzleGamesPage;
document.getElementById('obbyGamesBtn').onclick=showObbyGamesPage;
document.getElementById('sportsGamesBtn').onclick=showSportsGamesPage;
document.getElementById('backBtn').onclick=showHomePage;
document.getElementById('multiBackBtn').onclick=showHomePage;
document.getElementById('puzzleBackBtn').onclick=showHomePage;
document.getElementById('obbyBackBtn').onclick=showHomePage;
document.getElementById('sportsBackBtn').onclick=showHomePage;

function showSportsGamesPage(){
  const home=document.getElementById('homePage');
  const games=document.getElementById('gamesPage');
  const multi=document.getElementById('multigamesPage');
  const puzzle=document.getElementById('puzzlegamesPage');
  const obby=document.getElementById('obbygamesPage');
  const sports=document.getElementById('sportsgamesPage');
  home.style.opacity='0';
  games.style.display='none';
  multi.style.display='none';
  document.getElementById('infoShell').style.display = 'none';
  puzzle.style.display='none';
  obby.style.display='none';
  sports.style.display='flex';
  requestAnimationFrame(()=>{
    home.style.transition='opacity 0.5s';
    setTimeout(()=>{
      home.style.display='none';
      sports.classList.add('show');
      loadsportsGamesPage();
    },500);
  });
}

document.getElementById('lightToggle').onclick = () => {
  const isLight = document.body.classList.toggle('light');
  localStorage.setItem('kuppyLightMode', isLight);
  const savedTheme = JSON.parse(localStorage.getItem('kuppyTheme')) || {bg:'#0f1724', card:'#0b1220'};
  if(isLight){
    document.documentElement.style.setProperty('--bg', lighten(savedTheme.bg));
    document.documentElement.style.setProperty('--card', lighten(savedTheme.card));
    document.documentElement.style.setProperty('--text', '#111');
  } else {
    document.documentElement.style.setProperty('--bg', savedTheme.bg);
    document.documentElement.style.setProperty('--card', savedTheme.card);
    document.documentElement.style.setProperty('--text', '#e6eef8');
  }
};

let themeIndex = 0;
const themes = [
  { accent: '#FF0000', bg: '#2b0a0a', card: '#1b0505' },
  { accent: '#FF7F00', bg: '#2c1400', card: '#1f0a00' },
  { accent: '#FFFF00', bg: '#2b2b00', card: '#1a1a00' },
  { accent: '#00FF00', bg: '#002b00', card: '#001a00' },
  { accent: '#BFFF00', bg: '#1a2b00', card: '#0d1500' },
  { accent: '#00FFFF', bg: '#002b2b', card: '#001a1a' },
  { accent: '#0000FF', bg: '#00002b', card: '#00001a' },
  { accent: '#4B0082', bg: '#10002b', card: '#080015' },
  { accent: '#8B00FF', bg: '#1a002b', card: '#100015' },
  { accent: '#FFD700', bg: '#2b2200', card: '#1a1600' },
  { accent: '#C0C0C0', bg: '#2b2b2b', card: '#1a1a1a' },
  { accent: '#50C878', bg: '#002b1a', card: '#00140d' },
  { accent: '#9B111E', bg: '#2b0005', card: '#1a0002' },
  { accent: '#CCCCFF', bg: '#1a1a2b', card: '#0d0d15' },
  { accent: '#B87333', bg: '#2b1a0f', card: '#1a0d08' },
  { accent: '#B9F2FF', bg: '#1a2b2b', card: '#0d1515' }
];
document.getElementById('colorToggle').onclick=()=>{
  themeIndex=(themeIndex+1)%themes.length;
  const t=themes[themeIndex];
  localStorage.setItem('kuppyTheme', JSON.stringify(t));
  const isLight = document.body.classList.contains('light');
  document.documentElement.style.setProperty('--accent', t.accent);
  document.documentElement.style.setProperty('--bg', isLight ? lighten(t.bg) : t.bg);
  document.documentElement.style.setProperty('--card', isLight ? lighten(t.card) : t.card);
};

function getDailyGame() {
  const saved = JSON.parse(localStorage.getItem('customPresets') || '[]');
  const allGames = [...defaultGames, ...saved];
  if (allGames.length === 0) return alert('No games available!');

  const date = new Date();
  const dayOfYear = Math.floor(
    (Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()) -
     Date.UTC(date.getFullYear(), 0, 0)) / 24 / 60 / 60 / 1000
  );

  const index = dayOfYear % allGames.length;
  const dailyGame = allGames[index];

  openWebsite(dailyGame.url);
}

document.getElementById('dailyGameBtn').onclick = getDailyGame;

  const loginShell = document.getElementById('loginShell');
  const homePage = document.getElementById('homePage');
  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const loginMsg = document.getElementById('loginMsg');
  const userDisplay = document.getElementById('userDisplay');

loginShell.classList.add('fade');
homePage.classList.add('fade');

if (localStorage.getItem('kuppyTrusted') === 'true') {
  const autoUser = localStorage.getItem('kuppyAutoUser') || 'Kuppy';
  try {
    loginShell.classList.add('hidden');
    setTimeout(() => {
      loginShell.style.display = 'none';
      const weatherEnabled = localStorage.getItem('kuppyWeatherEnabled') === 'true';
document.getElementById('infoShell').style.display = weatherEnabled ? 'flex' : 'none';
      homePage.style.display = 'block';
      setTimeout(() => {
        homePage.classList.remove('hidden');
        startTyping();
      }, 10);
      userDisplay.textContent = autoUser;
      displayStarredGames();
    }, 500);
  } catch (e) {
    console.warn('Auto-login init failed:', e);
  }
}

userDisplay.addEventListener('click', () => {
  const confirmSignOut = confirm("Are you sure you want to log out?");
  if (!confirmSignOut) return;

  homePage.classList.add('hidden');
  const infoShell = document.getElementById('infoShell');
  if (infoShell) infoShell.style.display = 'none';

  const tempEl = document.getElementById('temperature');
  const descEl = document.getElementById('weatherDesc');
  const feelsEl = document.getElementById('feelsLike');
  const humEl = document.getElementById('humidity');
  const windEl = document.getElementById('windSpeed');
  const iconEl = document.getElementById('weatherIcon');
  if (tempEl) tempEl.textContent = '--¬∞F';
  if (descEl) descEl.textContent = '';
  if (feelsEl) feelsEl.textContent = '--¬∞F';
  if (humEl) humEl.textContent = '--%';
  if (windEl) windEl.textContent = '-- mph';
  if (iconEl) {
    iconEl.textContent = '';
    iconEl.classList.remove('rainy', 'sunny');
  }
  document.body.classList.remove('weather-rain', 'weather-snow', 'weather-sunny');

  setTimeout(() => {
    homePage.style.display = 'none';
    loginShell.style.display = 'flex';
    setTimeout(() => loginShell.classList.remove('hidden'), 10);
    loginUsername.value = '';
    loginPassword.value = '';
  }, 500);
});

const passwordInput = document.getElementById('loginPassword');
const togglePassword = document.getElementById('togglePassword');

togglePassword.addEventListener('click', () => {
  const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
  passwordInput.setAttribute('type', type);
  togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
});

const bgButton = document.getElementById('bgButton');
const bgUpload = document.getElementById('bgUpload');

bgButton.addEventListener('click', () => bgUpload.click());

bgUpload.addEventListener('change', (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const dataURL = e.target.result;
    localStorage.setItem('customBackground', dataURL);
    document.body.style.backgroundImage = `url(${dataURL})`;
  };
  reader.readAsDataURL(file);
});

window.addEventListener('load', () => {
  const savedBG = localStorage.getItem('customBackground');
  if (savedBG) {
    document.body.style.backgroundImage = `url(${savedBG})`;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center';
  }
});

function updateTime() {
  const now = new Date();
  let hours = now.getHours();
  const minutes = now.getMinutes();
  const ampm = hours >= 12 ? 'PM' : 'AM';
  hours = hours % 12 || 12;
  const timeStr = `${hours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
  
  const options = { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' };
  const dateStr = now.toLocaleDateString('en-US', options);
  
  document.getElementById('timeDisplay').textContent = timeStr;
  document.getElementById('dateDisplay').textContent = dateStr;
}

updateTime();
setInterval(updateTime, 1000);

async function fetchWeather() {
  try {
    const response = await fetch('https://wttr.in/Bridgewater,NJ?format=j1');
    
    if (!response.ok) {
      throw new Error('Weather data unavailable');
    }
    
    const data = await response.json();
    const current = data.current_condition[0];
    
    const temp = Math.round(parseFloat(current.temp_F));
    const feelsLike = Math.round(parseFloat(current.FeelsLikeF));
    const humidity = current.humidity;
    const windSpeed = Math.round(parseFloat(current.windspeedMiles));
    const desc = current.weatherDesc[0].value.toLowerCase();
    
    document.getElementById('temperature').textContent = `${temp}¬∞F`;
    document.getElementById('weatherDesc').textContent = desc;
    document.getElementById('feelsLike').textContent = `${feelsLike}¬∞F`;
    document.getElementById('humidity').textContent = `${humidity}%`;
    document.getElementById('windSpeed').textContent = `${windSpeed} mph`;
    
    const weatherIcons = {
      'clear': '‚òÄÔ∏è',
      'sunny': '‚òÄÔ∏è',
      'partly cloudy': '‚õÖ',
      'cloudy': '‚òÅÔ∏è',
      'overcast': '‚òÅÔ∏è',
      'mist': 'üå´Ô∏è',
      'fog': 'üå´Ô∏è',
      'light rain': 'üå¶Ô∏è',
      'rain': 'üåßÔ∏è',
      'heavy rain': 'üåßÔ∏è',
      'thunderstorm': '‚õàÔ∏è',
      'snow': '‚ùÑÔ∏è',
      'light snow': 'üå®Ô∏è'
    };
    
    let icon = 'üå§Ô∏è';
    for (const [key, value] of Object.entries(weatherIcons)) {
      if (desc.includes(key)) {
        icon = value;
        break;
      }
    }
    document.getElementById('weatherIcon').textContent = icon;
    
  } catch (error) {
    console.error('Weather fetch error:', error);
    document.getElementById('weatherDesc').textContent = 'Weather unavailable';
    document.getElementById('temperature').textContent = '--¬∞F';
  }
}

if (localStorage.getItem('kuppyWeatherEnabled') === 'true') {
  fetchWeather();
  setInterval(fetchWeather, 600000);
}

document.addEventListener('mousemove', (e) => {
  const cards = document.querySelectorAll('.card');
  
  cards.forEach(card => {
    const rect = card.getBoundingClientRect();
    const cardCenterX = rect.left + rect.width / 2;
    const cardCenterY = rect.top + rect.height / 2;
    
    const distanceX = e.clientX - cardCenterX;
    const distanceY = e.clientY - cardCenterY;
    const distance = Math.sqrt(distanceX * distanceX + distanceY * distanceY);
    
    if (distance < 200) {
      const angleX = (distanceY / rect.height) * 15;
      const angleY = (distanceX / rect.width) * -15;
      
      card.style.transform = `perspective(1000px) rotateX(${angleX}deg) rotateY(${angleY}deg) translateY(-8px) scale(1.05)`;
    } else {
      card.style.transform = '';
    }
  });
});

function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  
  const icon = type === 'success' ? '‚úì' : '‚úó';
  toast.innerHTML = `<span style="font-size:20px;">${icon}</span><span>${message}</span>`;
  
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.style.animation = 'toastSlideIn 0.3s reverse';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

const originalFetchWeather = fetchWeather;
fetchWeather = async function() {
  await originalFetchWeather();
  
  const desc = document.getElementById('weatherDesc').textContent.toLowerCase();
  const weatherIcon = document.getElementById('weatherIcon');
  
  document.body.classList.remove('weather-rain', 'weather-snow', 'weather-sunny');
  
  if (desc.includes('rain') || desc.includes('drizzle')) {
    document.body.classList.add('weather-rain');
    weatherIcon.classList.add('rainy');
  } else if (desc.includes('snow')) {
    document.body.classList.add('weather-snow');
  } else if (desc.includes('clear') || desc.includes('sunny')) {
    document.body.classList.add('weather-sunny');
    weatherIcon.classList.add('sunny');
  }
};

const parallaxElements = document.querySelectorAll('.shell, .info-shell');
window.addEventListener('scroll', () => {
  const scrolled = window.pageYOffset;
  
  parallaxElements.forEach((el, index) => {
    const speed = 0.05 * (index + 1);
    el.style.transform = `translateY(${scrolled * speed}px)`;
  });
});

fetchWeather();

const originalCreateGameCard = createGameCard;
createGameCard = function(g, idx, savedArray, starredArray, categoryLength, reloadFn) {
  const card = originalCreateGameCard(g, idx, savedArray, starredArray, categoryLength, reloadFn);
  
  const starBtn = card.querySelector('.starBtn');
  if (starBtn) {
    const originalOnClick = starBtn.onclick;
    starBtn.onclick = (e) => {
      e.stopPropagation();
      
      const wasStarred = starBtn.classList.contains('starred');
      originalOnClick(e);
      
      if (!wasStarred) {
        showToast(`‚≠ê ${g.name} added to favorites!`, 'success');
      } else {
        showToast(`${g.name} removed from favorites`, 'success');
      }
    };
  }
  
  return card;
};

function createRipple(event, element) {
  const ripple = document.createElement('span');
  const rect = element.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  const x = event.clientX - rect.left - size / 2;
  const y = event.clientY - rect.top - size / 2;
  
  ripple.style.cssText = `
    position: absolute;
    width: ${size}px;
    height: ${size}px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    top: ${y}px;
    left: ${x}px;
    pointer-events: none;
    animation: rippleEffect 0.6s ease-out;
    z-index: 1;
  `;
  
  const style = document.createElement('style');
  if (!document.getElementById('rippleStyle')) {
    style.id = 'rippleStyle';
    style.textContent = `
      @keyframes rippleEffect {
        from {
          transform: scale(0);
          opacity: 1;
        }
        to {
          transform: scale(2);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  }
  
  element.appendChild(ripple);
  setTimeout(() => ripple.remove(), 600);
}

document.addEventListener('click', (e) => {
  const card = e.target.closest('.card');
  if (card && !e.target.closest('.starBtn') && !e.target.closest('.deleteBtn')) {
    createRipple(e, card);
  }
});

document.querySelectorAll('.btn').forEach(btn => {
  btn.addEventListener('mouseenter', function() {
    this.style.transform = 'translateY(-2px) scale(1.02)';
  });
  
  btn.addEventListener('mouseleave', function() {
    this.style.transform = '';
  });
  
  btn.addEventListener('mousedown', function() {
    this.style.transform = 'scale(0.92)';
  });
  
  btn.addEventListener('mouseup', function() {
    this.style.transform = 'translateY(-2px) scale(1.02)';
  });
});

function showSkeletonLoaders(gridElement, count = 10) {
  gridElement.innerHTML = '';
  
  for (let i = 0; i < count; i++) {
    const skeleton = document.createElement('div');
    skeleton.className = 'card skeleton';
    skeleton.style.width = '135px';
    skeleton.style.height = '135px';
    skeleton.style.animationDelay = `${i * 0.1}s`;
    gridElement.appendChild(skeleton);
  }
}

const originalLoadGamesPage = loadGamesPage;
loadGamesPage = function() {
  const grid = document.getElementById('allGamesGrid');
  showSkeletonLoaders(grid, 20);
  
  setTimeout(() => {
    originalLoadGamesPage();
  }, 300);
};

const originalLoadMultiGamesPage = loadmultiGamesPage;
loadmultiGamesPage = function() {
  const grid = document.getElementById('multiGamesGrid');
  showSkeletonLoaders(grid, 8);
  
  setTimeout(() => {
    originalLoadMultiGamesPage();
  }, 300);
};

const originalLoadPuzzleGamesPage = loadpuzzleGamesPage;
loadpuzzleGamesPage = function() {
  const grid = document.getElementById('puzzleGamesGrid');
  showSkeletonLoaders(grid, 8);
  
  setTimeout(() => {
    originalLoadPuzzleGamesPage();
  }, 300);
};

const originalLoadObbyGamesPage = loadobbyGamesPage;
loadobbyGamesPage = function() {
  const grid = document.getElementById('obbyGamesGrid');
  showSkeletonLoaders(grid, 5);
  
  setTimeout(() => {
    originalLoadObbyGamesPage();
  }, 300);
};

const originalLoadSportsGamesPage = loadsportsGamesPage;
loadsportsGamesPage = function() {
  const grid = document.getElementById('sportsGamesGrid');
  showSkeletonLoaders(grid, 7);
  
  setTimeout(() => {
    originalLoadSportsGamesPage();
  }, 300);
};

document.addEventListener('mousemove', (e) => {
  const cards = document.querySelectorAll('.card:not(.skeleton)');
  
  cards.forEach(card => {
    const rect = card.getBoundingClientRect();
    const cardCenterX = rect.left + rect.width / 2;
    const cardCenterY = rect.top + rect.height / 2;
    
    const distanceX = e.clientX - cardCenterX;
    const distanceY = e.clientY - cardCenterY;
    const distance = Math.sqrt(distanceX * distanceX + distanceY * distanceY);
    
    if (distance < 150 && distance > 0) {
      const pullStrength = (150 - distance) / 150;
      const pullX = (distanceX / distance) * pullStrength * 8;
      const pullY = (distanceY / distance) * pullStrength * 8;
      
      const currentTransform = card.style.transform || '';
      if (!currentTransform.includes('perspective')) {
        card.style.transform = `translate(${pullX}px, ${pullY}px)`;
      }
    }
  });
});

const originalShowGamesPage = showGamesPage;
showGamesPage = function() {
  const home = document.getElementById('homePage');
  const games = document.getElementById('gamesPage');
  
  home.style.transform = 'translateX(-100%)';
  home.style.opacity = '0';
  
  setTimeout(() => {
    home.style.display = 'none';
    home.style.transform = '';
    document.getElementById('infoShell').style.display = 'none';
    games.style.display = 'flex';
    games.classList.add('show');
    loadGamesPage();
  }, 500);
};

const originalShowHomePage = showHomePage;
showHomePage = function() {
  const home = document.getElementById('homePage');
  const pages = [
    document.getElementById('gamesPage'),
    document.getElementById('multigamesPage'),
    document.getElementById('puzzlegamesPage'),
    document.getElementById('obbygamesPage'),
    document.getElementById('sportsgamesPage')
  ];
  
  pages.forEach(page => {
    page.style.transform = 'translateX(100%)';
    page.style.opacity = '0';
    page.classList.remove('show');
  });
  
  setTimeout(() => {
    pages.forEach(page => {
      page.style.display = 'none';
      page.style.transform = '';
    });
    
    const weatherEnabled = localStorage.getItem('kuppyWeatherEnabled') === 'true';
document.getElementById('infoShell').style.display = weatherEnabled ? 'flex' : 'none';
    home.style.display = 'block';
    home.style.transform = 'translateX(-100%)';
    home.style.opacity = '0';
    
    requestAnimationFrame(() => {
      home.style.transition = 'transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s';
      home.style.transform = 'translateX(0)';
      home.style.opacity = '1';
      displayStarredGames();
    });
  }, 500);
};

const categoryTransitions = [
  { show: showMultiGamesPage, page: 'multigamesPage' },
  { show: showPuzzleGamesPage, page: 'puzzlegamesPage' },
  { show: showObbyGamesPage, page: 'obbygamesPage' },
  { show: showSportsGamesPage, page: 'sportsgamesPage' }
];

categoryTransitions.forEach(({ show, page }) => {
  const originalShow = window[show.name];
  window[show.name] = function() {
    const home = document.getElementById('homePage');
    const targetPage = document.getElementById(page);
    
    home.style.transform = 'translateX(-100%)';
    home.style.opacity = '0';
    
    setTimeout(() => {
      home.style.display = 'none';
      home.style.transform = '';
      document.getElementById('infoShell').style.display = 'none';
      targetPage.style.display = 'flex';
      targetPage.classList.add('show');
      
      const loadFnName = 'load' + page.replace('Page', 'Page').replace('games', 'Games');
      if (window[loadFnName]) window[loadFnName]();
    }, 500);
  };
});

const originalRandomBtn = document.getElementById('randomGameBtn').onclick;
document.getElementById('randomGameBtn').onclick = function() {
  showToast('üé≤ Selecting random game...', 'success');
  setTimeout(() => {
    originalRandomBtn();
  }, 300);
};

const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    mutation.addedNodes.forEach((node) => {
      if (node.classList && node.classList.contains('card') && !node.classList.contains('skeleton')) {
        const cards = Array.from(node.parentElement.children);
        const index = cards.indexOf(node);
        node.style.animation = `fadeInScale 0.4s ease-out ${index * 0.05}s both`;
      }
    });
  });
});

['allGamesGrid', 'multiGamesGrid', 'puzzleGamesGrid', 'obbyGamesGrid', 'sportsGamesGrid'].forEach(id => {
  const grid = document.getElementById(id);
  if (grid) {
    observer.observe(grid, { childList: true });
  }
});

const KuppyState = {
  soundEnabled: localStorage.getItem('kuppySoundEnabled') !== 'false',
  stats: JSON.parse(localStorage.getItem('kuppyStats') || '{"launches":0,"favorites":0,"playtime":0,"games":{}}'),
  badges: JSON.parse(localStorage.getItem('kuppyBadges') || '[]'),
  combo: 0,
  comboTimer: null,
  customCursor: localStorage.getItem('kuppyCustomCursor') === 'true',
};

function createConfetti(x, y, count = 50) {
  const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#ff69b4'];
  
  for (let i = 0; i < count; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = x + 'px';
    confetti.style.top = y + 'px';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDuration = (Math.random() * 2 + 1) + 's';
    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
    
    const angle = (Math.random() * 360) * Math.PI / 180;
    const velocity = Math.random() * 200 + 100;
    confetti.style.setProperty('--tx', Math.cos(angle) * velocity + 'px');
    confetti.style.setProperty('--ty', Math.sin(angle) * velocity + 'px');
    
    document.body.appendChild(confetti);
    
    setTimeout(() => confetti.remove(), 3000);
  }
  
}

const achievements = [
  { id: 'first_launch', name: 'First Steps', desc: 'Launch your first game', icon: 'üéÆ', check: () => KuppyState.stats.launches >= 1 },
  { id: 'game_hoarder', name: 'Game Hoarder', desc: 'Star 5 games', icon: '‚≠ê', check: () => KuppyState.stats.favorites >= 5 },
  { id: 'dedicated', name: 'Dedicated Player', desc: 'Launch 25 games', icon: 'üèÜ', check: () => KuppyState.stats.launches >= 25 },
  { id: 'speed_runner', name: 'Speed Runner', desc: 'Build a 5x combo', icon: '‚ö°', check: () => false },
  { id: 'night_owl', name: 'Night Owl', desc: 'Use KuppyCloaker after midnight', icon: 'ü¶â', check: () => new Date().getHours() >= 0 && new Date().getHours() < 6 },
  { id: 'collector', name: 'Collector', desc: 'Star 10 games', icon: 'üíé', check: () => KuppyState.stats.favorites >= 10 },
  { id: 'explorer', name: 'Explorer', desc: 'Try the random game 10 times', icon: 'üß≠', check: () => (KuppyState.stats.games['__random__'] || 0) >= 10 },
  { id: 'marathon', name: 'Marathon Runner', desc: 'Launch 50 games', icon: 'üèÉ', check: () => KuppyState.stats.launches >= 50 },
  { id: 'master', name: 'Kuppy Master', desc: 'Earn all other badges', icon: 'üëë', check: () => KuppyState.badges.length >= 8 }
];

function checkAchievements() {
  achievements.forEach(achievement => {
    if (!KuppyState.badges.includes(achievement.id) && achievement.check()) {
      unlockAchievement(achievement);
    }
  });
  
  saveStats();
}

function unlockAchievement(achievement) {
  KuppyState.badges.push(achievement.id);
  localStorage.setItem('kuppyBadges', JSON.stringify(KuppyState.badges));
  
  const achDiv = document.createElement('div');
  achDiv.className = 'achievement';
  achDiv.innerHTML = `
    <div class="achievement-icon">${achievement.icon}</div>
    <div class="achievement-content">
      <h3>Achievement Unlocked!</h3>
      <p><strong>${achievement.name}</strong> - ${achievement.desc}</p>
    </div>
  `;
  
  document.body.appendChild(achDiv);
  
  createConfetti(window.innerWidth - 200, 100, 30);
  screenShake();
  
  setTimeout(() => achDiv.remove(), 4000);
  
  updateBadgeDisplay();
  checkAchievements();
}

function updateBadgeDisplay() {
  const badgeDisplay = document.getElementById('badgeDisplay');
  if (!badgeDisplay) return;

  badgeDisplay.innerHTML = '';
  
  achievements.forEach(ach => {
    const unlocked = KuppyState.badges.includes(ach.id);

    const badge = document.createElement('div');
    badge.className = 'badge' + (unlocked ? '' : ' locked');
    badge.innerHTML = ach.icon;
    badge.title = unlocked
      ? `${ach.name} ‚Äì ${ach.desc}`
      : `Locked ‚Äì ${ach.desc}`;

    badge.style.cursor = unlocked ? "help" : "not-allowed";

    badgeDisplay.appendChild(badge);
  });
}


function incrementCombo() {
  KuppyState.combo++;
  
  clearTimeout(KuppyState.comboTimer);
  KuppyState.comboTimer = setTimeout(() => {
    KuppyState.combo = 0;
  }, 2000);
  
  if (KuppyState.combo >= 2) {
    const comboDiv = document.getElementById('comboCounter');
    comboDiv.textContent = `x${KuppyState.combo} COMBO!`;
    comboDiv.classList.remove('show');
    void comboDiv.offsetWidth;
    comboDiv.classList.add('show');
    
    setTimeout(() => {
      comboDiv.classList.remove('show');
    }, 1000);
  }
  
  if (KuppyState.combo >= 5 && !KuppyState.badges.includes('speed_runner')) {
    unlockAchievement(achievements.find(a => a.id === 'speed_runner'));
  }
}

function screenShake() {
  document.body.classList.add('shake');
  setTimeout(() => {
    document.body.classList.remove('shake');
  }, 500);
}

function trackGameLaunch(gameName) {
  KuppyState.stats.launches++;
if (gameName !== 'Unknown Game') {
  KuppyState.stats.games[gameName] =
    (KuppyState.stats.games[gameName] || 0) + 1;
}

  
  incrementCombo();
  saveStats();
  checkAchievements();
}

function saveStats() {
  localStorage.setItem('kuppyStats', JSON.stringify(KuppyState.stats));
}

function updateStatsDisplay() {
  document.getElementById('statLaunches').textContent = KuppyState.stats.launches;
  document.getElementById('statFavorites').textContent = JSON.parse(localStorage.getItem('starredGames') || '[]').length;
const totalMinutes = Math.floor(KuppyState.stats.playtime / 60);
const hours = Math.floor(totalMinutes / 60);
const minutes = totalMinutes % 60;
document.getElementById('statPlaytime').textContent = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;  
  const mostPlayed = Object.entries(KuppyState.stats.games)
    .filter(([name]) => name !== '__random__')
    .sort(([,a], [,b]) => b - a)[0];
  
  document.getElementById('statMostPlayed').textContent = mostPlayed ? `${mostPlayed[0]} (${mostPlayed[1]}x)` : 'None';
  document.getElementById('statBadges').textContent = `${KuppyState.badges.length}/${achievements.length}`;
  
  updateBadgeDisplay();
}
  
const fab = document.getElementById('fab');
const fabMenu = document.getElementById('fabMenu');
let fabOpen = false;

fab.onclick = () => {
  fabOpen = !fabOpen;
  fabMenu.classList.toggle('show');
  fab.style.transform = fabOpen ? 'rotate(135deg)' : '';
};

document.getElementById('fabStats').onclick = () => {
  document.getElementById('statsPanel').classList.add('show');
  updateStatsDisplay();
  fabMenu.classList.remove('show');
  fabOpen = false;
  fab.style.transform = '';
};

document.getElementById('statsClose').onclick = () => {
  document.getElementById('statsPanel').classList.remove('show');
};

document.getElementById('fabModules').onclick = () => {
  document.getElementById('modulesPanel').classList.add('show');
  document.getElementById('modulesBackdrop').classList.add('show');
  fabMenu.classList.remove('show');
  fabOpen = false;
  fab.style.transform = '';
};

const originalOpenWebsite = openWebsite;
openWebsite = function(url) {
  let gameName = 'Unknown Game';

  const normalizedUrl = url.replace(/^https?:\/\//, '');

  const saved = JSON.parse(localStorage.getItem('customPresets') || '[]');
  const allGames = [...defaultGames, ...saved];

  const found = allGames.find(g =>
    g.url.replace(/^https?:\/\//, '').includes(normalizedUrl)
  );

  if (found) {
    gameName = found.name;
  } else {
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
      const title = card.querySelector('.card-title')?.textContent || '';
      const onclickStr = card.onclick?.toString() || '';
      if (onclickStr.includes(url) || onclickStr.includes(normalizedUrl)) {
        gameName = title;
      }
    });
  }

  if (gameName !== 'Unknown Game') {
    trackGameLaunch(gameName);
    showToast(`üöÄ Launching ${gameName}...`, 'success');
  }

  originalOpenWebsite(url);
};

document.getElementById('randomGameBtn').addEventListener('click', function(e) {
  e.stopPropagation();
  
  const cards = Array.from(document.querySelectorAll('.card:not(.skeleton)'));
  if (cards.length === 0) return;
  
  let spins = 0;
  const maxSpins = 20;
  
  const spinInterval = setInterval(() => {
    cards.forEach(card => card.classList.remove('flipping'));
    
    const randomCard = cards[Math.floor(Math.random() * cards.length)];
    randomCard.classList.add('flipping');
    
    spins++;
    
    if (spins >= maxSpins) {
      clearInterval(spinInterval);
      
      setTimeout(() => {
        randomCard.click();
        trackGameLaunch('__random__');
      }, 300);
    }
  }, 100);
  
});

const originalStarClick = document.querySelector('.starBtn')?.onclick;

document.addEventListener('click', (e) => {
  if (e.target.classList.contains('starBtn')) {
    const rect = e.target.getBoundingClientRect();
    createConfetti(rect.left + rect.width / 2, rect.top + rect.height / 2, 20);
    
    setTimeout(() => {
      KuppyState.stats.favorites = JSON.parse(localStorage.getItem('starredGames') || '[]').length;
      saveStats();
      checkAchievements();
    }, 100);
  }
});

document.querySelectorAll('.btn, #fab').forEach(el => {
  el.classList.add('breathe');
});

window.addEventListener('load', () => {
  const welcomeOverlay = document.getElementById('welcomeOverlay');
  const welcomeProgress = document.getElementById('welcomeProgress');
  
  let progress = 0;
  const progressInterval = setInterval(() => {
    progress += Math.random() * 15 + 5;
    if (progress >= 100) progress = 100;
    
    welcomeProgress.style.width = progress + '%';
    
    if (progress >= 100) {
      clearInterval(progressInterval);
      
      setTimeout(() => {
        welcomeOverlay.classList.add('hide');
        
        setTimeout(() => {
          welcomeOverlay.remove();
        }, 1000);
      }, 500);
    }
  }, 150);
  
  checkAchievements();
});

const originalShowToast = showToast;
showToast = function(message, type = 'success') {
  originalShowToast(message, type);
  
  if (type === 'success') {
  } else if (type === 'error') {
  }
};

setInterval(() => {
  KuppyState.stats.playtime += 1;
  saveStats();
}, 1000);

document.querySelectorAll('.btn, button').forEach(btn => {
  btn.addEventListener('click', () => {
    if (!btn.id?.includes('sound') && !btn.id?.includes('stats')) {
    }
  });
});

document.addEventListener('click', (e) => {
  if (e.target.closest('.card') && !e.target.closest('.starBtn') && !e.target.closest('.deleteBtn')) {
  }
});

document.getElementById('allGamesBtn').addEventListener('click', () => {
  showToast('üìö Opening all games...', 'success');
});

document.getElementById('multiGamesBtn').addEventListener('click', () => {
  showToast('üßë‚Äçü§ù‚Äçüßë Loading multiplayer games...', 'success');
});

document.getElementById('puzzleGamesBtn').addEventListener('click', () => {
  showToast('üß© Brain teasers loading...', 'success');
});

document.getElementById('obbyGamesBtn').addEventListener('click', () => {
  showToast('üèÉ Parkour time!', 'success');
});

document.getElementById('sportsGamesBtn').addEventListener('click', () => {
  showToast('‚öΩ Sports games loading...', 'success');
});

document.getElementById('dailyGameBtn').addEventListener('click', () => {
  showToast('üìÖ Loading today\'s featured game...', 'success');
});

document.getElementById('recentGamesBtn').addEventListener('click', () => {
  const recent = JSON.parse(localStorage.getItem('recentGame'));
  if (recent) {
    showToast(`üïì Reopening ${recent.name}...`, 'success');
  }
});

[document.getElementById('backBtn'), 
 document.getElementById('multiBackBtn'),
 document.getElementById('puzzleBackBtn'),
 document.getElementById('obbyBackBtn'),
 document.getElementById('sportsBackBtn')].forEach(btn => {
  btn?.addEventListener('click', () => {
    showToast('üè† Returning home...', 'success');
  });
});

document.getElementById('lightToggle').addEventListener('click', () => {
  const isLight = document.body.classList.contains('light');
  showToast(isLight ? 'üåô Dark mode activated' : '‚òÄÔ∏è Light mode activated', 'success');
});

document.getElementById('colorToggle').addEventListener('click', () => {
  showToast('üé® Theme changed!', 'success');
});

let clickCount = 0;
let clickTimer = null;

document.getElementById('typedTitle').addEventListener('click', () => {
  clickCount++;
  
  clearTimeout(clickTimer);
  clickTimer = setTimeout(() => {
    clickCount = 0;
  }, 500);
  
  if (clickCount === 3) {
    const easterEgg = document.createElement('div');
    easterEgg.className = 'easter-egg-found';
    easterEgg.textContent = 'üéâ';
    document.body.appendChild(easterEgg);
    
    createConfetti(window.innerWidth / 2, 100, 50);    
    setTimeout(() => easterEgg.remove(), 2000);
    
    showToast('üéâ You found the secret! Here\'s a surprise!', 'success');
    
    const saved = JSON.parse(localStorage.getItem('customPresets') || '[]');
    const allGames = [...defaultGames, ...saved];
    const randomGame = allGames[Math.floor(Math.random() * allGames.length)];
    
    let starred = JSON.parse(localStorage.getItem('starredGames') || '[]');
    if (!starred.includes(randomGame.name)) {
      starred.push(randomGame.name);
      localStorage.setItem('starredGames', JSON.stringify(starred));
      showToast(`‚≠ê ${randomGame.name} has been auto-starred!`, 'success');
      displayStarredGames();
    }
    
    clickCount = 0;
  }
});

updateBadgeDisplay();
checkAchievements();

const cardObserver = new MutationObserver(() => {
  document.querySelectorAll('.card:not(.breathe-checked)').forEach(card => {
    card.classList.add('breathe-checked');
    
    card.addEventListener('mouseenter', () => {
      if (KuppyState.soundEnabled) {
        playSound(300, 0.05, 'sine');
      }
    });
  });
});

['allGamesGrid', 'multiGamesGrid', 'puzzleGamesGrid', 'obbyGamesGrid', 'sportsGamesGrid'].forEach(id => {
  const grid = document.getElementById(id);
  if (grid) {
    cardObserver.observe(grid, { childList: true, subtree: true });
  }
});

if (KuppyState.stats.launches > 0 && KuppyState.stats.launches % 10 === 0) {
  setTimeout(() => {
    createConfetti(window.innerWidth / 2, window.innerHeight / 2, 30);
    showToast(`üéâ Milestone! You've launched ${KuppyState.stats.launches} games!`, 'success');
  }, 3000);
}

const ModulesSystem = {
  widgets: [],
  nextId: 1,
  
  init() {    
    try {
      const saved = localStorage.getItem('kuppyWidgets');
      if (saved) {
        this.widgets = JSON.parse(saved);
      }
      const savedId = localStorage.getItem('kuppyWidgetNextId');
      if (savedId) {
        this.nextId = parseInt(savedId);
      }
    } catch (e) {
      console.error('Error loading widgets:', e);
    }
    
    this.setupListeners();
    this.loadAllWidgets();
    
  },
  
  setupListeners() {
    const fabModules = document.getElementById('fabModules');
    if (fabModules) {
      fabModules.onclick = () => {
        const panel = document.getElementById('modulesPanel');
        const backdrop = document.getElementById('modulesBackdrop');
        
        if (panel) panel.classList.add('show');
        if (backdrop) backdrop.classList.add('show');
        
        const fabMenu = document.getElementById('fabMenu');
        const fab = document.getElementById('fab');
        if (fabMenu) fabMenu.classList.remove('show');
        if (fab) fab.style.transform = '';
      };
    }
    
    const closeBtn = document.getElementById('modulesClose');
    if (closeBtn) {
      closeBtn.onclick = (e) => {
        e.stopPropagation();
        this.closePanel();
      };
    }
    
const backdrop = document.getElementById('modulesBackdrop');
if (backdrop) {
  backdrop.onclick = () => {
    this.closePanel();
  };
}

const cards = document.querySelectorAll('.module-card');

cards.forEach(card => {
  card.onclick = () => {
    const moduleType = card.dataset.module;
    
    if (moduleType === 'postit') {
      const centerX = Math.max(50, (window.innerWidth / 2) - 100);
      const centerY = Math.max(50, (window.innerHeight / 2) - 100);
      
      this.createWidget('postit', {
        position: { x: centerX, y: centerY }
      });
      
      if (typeof showToast === 'function') {
        showToast('üìù Post-it note added!', 'success');
      }
      
      this.closePanel();
    } else if (moduleType === 'weather') {
      const isEnabled = localStorage.getItem('kuppyWeatherEnabled') === 'true';
      
      if (isEnabled) {
        localStorage.setItem('kuppyWeatherEnabled', 'false');
        document.getElementById('infoShell').style.display = 'none';
        if (typeof showToast === 'function') {
          showToast('üå§Ô∏è Weather widget disabled.', 'success');
        }
      } else {
        localStorage.setItem('kuppyWeatherEnabled', 'true');
        if (document.getElementById('homePage').style.display !== 'none') {
          const weatherEnabled = localStorage.getItem('kuppyWeatherEnabled') === 'true';
          document.getElementById('infoShell').style.display = weatherEnabled ? 'flex' : 'none';
        }
        fetchWeather();
        if (typeof showToast === 'function') {
          showToast('üå§Ô∏è Weather widget enabled!', 'success');
        }
      }
      
      this.closePanel();
    } else if (moduleType === 'timer') {
      const centerX = Math.max(50, (window.innerWidth / 2) - 160);
      const centerY = Math.max(50, (window.innerHeight / 2) - 140);
      
      this.createWidget('timer', {
        position: { x: centerX, y: centerY }
      });
      
      if (typeof showToast === 'function') {
        showToast('‚è∞ Class timer added!', 'success');
      }
      
      this.closePanel();
    } else {
      if (typeof showToast === 'function') {
        showToast('This module is coming soon!', 'error');
      }
    }
  };
});
  },
  
  closePanel() {
    const panel = document.getElementById('modulesPanel');
    const backdrop = document.getElementById('modulesBackdrop');
    
    if (panel) panel.classList.remove('show');
    if (backdrop) backdrop.classList.remove('show');
  },
  
  saveWidgets() {
    try {
      localStorage.setItem('kuppyWidgets', JSON.stringify(this.widgets));
      localStorage.setItem('kuppyWidgetNextId', this.nextId.toString());
    } catch (e) {
      console.error('Error saving widgets:', e);
    }
  },
  
  createWidget(type, data = {}) {    
    const widget = {
      id: this.nextId++,
      type: type,
      position: data.position || { x: 100, y: 100 },
      data: data.content || { text: '' }
    };
    
    this.widgets.push(widget);
    this.saveWidgets();
    this.renderWidget(widget);
    
    return widget;
  },
  
  deleteWidget(id) {
    this.widgets = this.widgets.filter(w => w.id !== id);
    this.saveWidgets();
    
    const widgetEl = document.querySelector(`[data-widget-id="${id}"]`);
    if (widgetEl) {
      widgetEl.style.animation = 'fadeInScale 0.3s reverse';
      setTimeout(() => widgetEl.remove(), 300);
    }
  },
  
renderWidget(widget) {  
  const container = document.body;
  if (!container) {
    console.error('Container not found!');
    return;
  }
  
  const widgetEl = document.createElement('div');
  widgetEl.className = 'widget-container';
  widgetEl.dataset.widgetId = widget.id;
  widgetEl.style.position = 'fixed';
  widgetEl.style.left = widget.position.x + 'px';
  widgetEl.style.top = widget.position.y + 'px';
  widgetEl.style.zIndex = '2000';
  
  if (widget.type === 'postit') {
    if (!widget.data.color) {
      widget.data.color = '#ffd54f';
      widget.data.colorLight = '#ffeb3b';
    }
    if (!widget.data.width) widget.data.width = 280;
    if (!widget.data.height) widget.data.height = 280;
    
    widgetEl.innerHTML = `
      <div class="widget postit-widget" style="--postit-color: ${widget.data.color}; --postit-color-light: ${widget.data.colorLight}; width: ${widget.data.width}px; height: ${widget.data.height}px;">
        <div class="widget-header">
          <input type="text" class="postit-title-input" placeholder="Note Title" value="${widget.data.title || ''}" />
          <div class="widget-controls">
            <button class="widget-btn widget-delete" title="Delete">√ó</button>
          </div>
        </div>
        <div class="widget-content">
          <textarea class="postit-textarea" placeholder="Type your note here...">${widget.data.text || ''}</textarea>
        </div>
        <div class="postit-colors">
          <div class="postit-color-btn ${widget.data.color === '#ffd54f' ? 'active' : ''}" data-color="#ffd54f" data-color-light="#ffeb3b" style="background: linear-gradient(135deg, #ffd54f, #ffeb3b);" title="Yellow"></div>
          <div class="postit-color-btn ${widget.data.color === '#ffb3ba' ? 'active' : ''}" data-color="#ffb3ba" data-color-light="#ffccd5" style="background: linear-gradient(135deg, #ffb3ba, #ffccd5);" title="Pink"></div>
          <div class="postit-color-btn ${widget.data.color === '#bae1ff' ? 'active' : ''}" data-color="#bae1ff" data-color-light="#d4edff" style="background: linear-gradient(135deg, #bae1ff, #d4edff);" title="Blue"></div>
          <div class="postit-color-btn ${widget.data.color === '#baffc9' ? 'active' : ''}" data-color="#baffc9" data-color-light="#d4ffe0" style="background: linear-gradient(135deg, #baffc9, #d4ffe0);" title="Green"></div>
          <div class="postit-color-btn ${widget.data.color === '#ffffba' ? 'active' : ''}" data-color="#ffffba" data-color-light="#ffffd4" style="background: linear-gradient(135deg, #ffffba, #ffffd4);" title="Light Yellow"></div>
          <div class="postit-color-btn ${widget.data.color === '#e0bbff' ? 'active' : ''}" data-color="#e0bbff" data-color-light="#f0d4ff" style="background: linear-gradient(135deg, #e0bbff, #f0d4ff);" title="Purple"></div>
          <div class="postit-color-btn ${widget.data.color === '#ffd9b3' ? 'active' : ''}" data-color="#ffd9b3" data-color-light="#ffe8d4" style="background: linear-gradient(135deg, #ffd9b3, #ffe8d4);" title="Orange"></div>
        </div>
      </div>
    `;
    
    container.appendChild(widgetEl);
    
    const postitWidget = widgetEl.querySelector('.postit-widget');
    
    const resizeObserver = new ResizeObserver(entries => {
      for (let entry of entries) {
        const newWidth = entry.contentRect.width;
        const newHeight = entry.contentRect.height;
        
        widget.data.width = newWidth;
        widget.data.height = newHeight;
        this.saveWidgets();
        
      }
    });
    
    resizeObserver.observe(postitWidget);
    
    const titleInput = widgetEl.querySelector('.postit-title-input');
    if (titleInput) {
      titleInput.oninput = (e) => {
        widget.data.title = e.target.value;
        this.saveWidgets();
      };
    }
    
    const textarea = widgetEl.querySelector('.postit-textarea');
    if (textarea) {
      textarea.oninput = (e) => {
        widget.data.text = e.target.value;
        this.saveWidgets();
      };
    }
    
    const colorBtns = widgetEl.querySelectorAll('.postit-color-btn');
    colorBtns.forEach(btn => {
      btn.onclick = (e) => {
        e.stopPropagation();
        const color = btn.dataset.color;
        const colorLight = btn.dataset.colorLight;
        
        widget.data.color = color;
        widget.data.colorLight = colorLight;
        this.saveWidgets();
        
        postitWidget.style.setProperty('--postit-color', color);
        postitWidget.style.setProperty('--postit-color-light', colorLight);
        
        colorBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      };
    });
    
    const deleteBtn = widgetEl.querySelector('.widget-delete');
    if (deleteBtn) {
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        if (confirm('Delete this post-it note?')) {
          this.deleteWidget(widget.id);
          if (typeof showToast === 'function') {
            showToast('üóëÔ∏è Post-it deleted', 'success');
          }
        }
      };
    }
    
    this.makeWidgetDraggable(widgetEl, widget);
    
  } else if (widget.type === 'timer') {
    if (!widget.data.schedule) {
      widget.data.schedule = JSON.parse(localStorage.getItem('kuppyClassSchedule') || '{}');
    }
    if (!widget.data.focusDuration) {
      widget.data.focusDuration = parseInt(localStorage.getItem('kuppyFocusDuration') || '10');
    }
    
    const currentInfo = this.getCurrentClassInfo(widget.data.schedule);
    
    widgetEl.innerHTML = `
      <div class="widget timer-widget">
        <div class="widget-header">
          <div class="widget-title">‚è∞ Class Timer</div>
          <div class="widget-controls">
            <button class="widget-btn widget-settings" title="Settings">‚öôÔ∏è</button>
            <button class="widget-btn widget-delete" title="Delete">√ó</button>
          </div>
        </div>
<div class="widget-content">
  <div class="timer-block">
    <div class="timer-block-label">Current Class</div>
    <div class="timer-block-value">${currentInfo.currentClass}</div>
  </div>
  
  <div class="timer-countdown">
    <div class="timer-countdown-time" id="timer-countdown-${widget.id}">--:--</div>
    <div class="timer-countdown-label">Time Remaining</div>
  </div>
  
  <div class="timer-block">
    <div class="timer-block-label">Next Class</div>
    <div class="timer-block-value">${currentInfo.nextClass}</div>
  </div>
  
  <div class="timer-controls">
    <button class="timer-btn focus-5">üéØ Focus 5m</button>
    <button class="timer-btn focus-10">üéØ Focus 10m</button>
    <button class="timer-btn secondary focus-custom">‚öôÔ∏è Custom</button>
  </div>
</div>
      </div>
    `;
    
    container.appendChild(widgetEl);
    
    this.startTimerCountdown(widget);
    
    const settingsBtn = widgetEl.querySelector('.widget-settings');
    if (settingsBtn) {
      settingsBtn.onclick = (e) => {
        e.stopPropagation();
        this.showTimerSettings(widget);
      };
    }
    
    const deleteBtn = widgetEl.querySelector('.widget-delete');
    if (deleteBtn) {
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        if (confirm('Delete this timer?')) {
          this.deleteWidget(widget.id);
          if (typeof showToast === 'function') {
            showToast('üóëÔ∏è Timer deleted', 'success');
          }
        }
      };
    }
    
    widgetEl.querySelector('.focus-5').onclick = () => this.startFocusMode(5, widget);
    widgetEl.querySelector('.focus-10').onclick = () => this.startFocusMode(10, widget);
    widgetEl.querySelector('.focus-custom').onclick = () => {
      const minutes = prompt('Enter focus duration in minutes:', widget.data.focusDuration);
      if (minutes && !isNaN(minutes) && minutes > 0) {
        this.startFocusMode(parseInt(minutes), widget);
      }
    };
    
    this.makeWidgetDraggable(widgetEl, widget);
  }
},
  
makeWidgetDraggable(element, widget) {
  const header = element.querySelector('.widget-header');
  if (!header) return;
  
  let isDragging = false;
  let startX, startY, initialLeft, initialTop;
  
  header.onmousedown = (e) => {
    if (e.target.closest('.widget-btn') || 
        e.target.closest('textarea') || 
        e.target.closest('.postit-color-btn') ||
        e.target.closest('.postit-title-input')) {
      return;
    }
    
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    
    const rect = element.getBoundingClientRect();
    initialLeft = rect.left;
    initialTop = rect.top;
    
    element.style.zIndex = '2001';
    header.style.cursor = 'grabbing';
    
    e.preventDefault();
  };
  
  const handleMouseMove = (e) => {
    if (!isDragging) return;
    
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    
    const newLeft = initialLeft + deltaX;
    const newTop = initialTop + deltaY;
    
    const maxLeft = window.innerWidth - element.offsetWidth;
    const maxTop = window.innerHeight - element.offsetHeight;
    
    element.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + 'px';
    element.style.top = Math.max(0, Math.min(newTop, maxTop)) + 'px';
  };
  
  const handleMouseUp = () => {
    if (!isDragging) return;
    
    isDragging = false;
    header.style.cursor = 'move';
    element.style.zIndex = '2000';
    
    widget.position = {
      x: parseInt(element.style.left),
      y: parseInt(element.style.top)
    };
    this.saveWidgets();
  };
  
  document.addEventListener('mousemove', handleMouseMove);
  document.addEventListener('mouseup', handleMouseUp);
},
  
  loadAllWidgets() {
    const container = document.getElementById('widgetsContainer');
    if (!container) return;
    
    container.innerHTML = '';
    this.widgets.forEach(widget => this.renderWidget(widget));
    
  },
getCurrentClassInfo(schedule) {
  const now = new Date();
  const day = now.getDay();
  const hours = now.getHours();
  const minutes = now.getMinutes();
  const currentTime = hours * 60 + minutes;
  
  const blockMapping = {
    'Homeroom': 'Homeroom',
    'TB1': 'Block 1',
    'TB2': 'Block 2',
    'TB3': 'Block 3',
    'TB4': 'Block 4',
    'Lunch': 'Lunch',
    'TB5': 'Block 5',
    'TB6': 'Block 6',
    'TB7': 'Block 7',
    'TB8': 'Block 8'
  };
  
  const timeBlocks = [
    { name: 'Homeroom', start: 8 * 60 + 10, end: 8 * 60 + 18 },
    { name: 'TB1', start: 8 * 60 + 21, end: 9 * 60 + 1 },
    { name: 'TB2', start: 9 * 60 + 4, end: 9 * 60 + 44 },
    { name: 'TB3', start: 9 * 60 + 47, end: 10 * 60 + 27 },
    { name: 'TB4', start: 10 * 60 + 30, end: 11 * 60 + 10 },
    { name: 'Lunch', start: 11 * 60 + 13, end: 11 * 60 + 43 },
    { name: 'TB5', start: 11 * 60 + 46, end: 12 * 60 + 26 },
    { name: 'TB6', start: 12 * 60 + 29, end: 13 * 60 + 9 },
    { name: 'TB7', start: 13 * 60 + 12, end: 13 * 60 + 52 },
    { name: 'TB8', start: 13 * 60 + 55, end: 14 * 60 + 35 },
  ];
  
  if (day === 0 || day === 6) {
    return {
      currentBlock: 'Weekend',
      currentClass: 'No Classes',
      nextClass: 'Enjoy your day!',
      remainingMinutes: 0
    };
  }
  
  let currentBlock = null;
  let nextBlock = null;
  
  for (let i = 0; i < timeBlocks.length; i++) {
    const block = timeBlocks[i];
    if (currentTime >= block.start && currentTime < block.end) {
      currentBlock = block;
      nextBlock = timeBlocks[i + 1] || null;
      break;
    } else if (currentTime < block.start && !currentBlock) {
      nextBlock = block;
      break;
    }
  }
  
  if (!currentBlock && currentTime < timeBlocks[0].start) {
    return {
      currentBlock: 'Before School',
      currentClass: 'School starts soon',
      nextClass: schedule['Block 1'] || 'Not set',
      remainingMinutes: timeBlocks[0].start - currentTime
    };
  }
  
  if (!currentBlock && currentTime >= timeBlocks[timeBlocks.length - 1].end) {
    return {
      currentBlock: 'After School',
      currentClass: 'School is over',
      nextClass: 'See you tomorrow!',
      remainingMinutes: 0
    };
  }
  
  if (!currentBlock && nextBlock) {
    const scheduleKey = blockMapping[nextBlock.name] || nextBlock.name;
    return {
      currentBlock: 'Between Classes',
      currentClass: 'Break time',
      nextClass: schedule[scheduleKey] || 'Not set',
      remainingMinutes: nextBlock.start - currentTime
    };
  }
  
  if (currentBlock) {
    const remainingMinutes = currentBlock.end - currentTime;
    const scheduleKey = blockMapping[currentBlock.name] || currentBlock.name;
    const nextScheduleKey = nextBlock ? (blockMapping[nextBlock.name] || nextBlock.name) : null;
    
    const currentClassName = schedule[scheduleKey] || 'Not set';
    const nextClassName = nextBlock ? (schedule[nextScheduleKey] || 'Not set') : 'End of day';
    
    return {
      currentBlock: currentBlock.name,
      currentClass: currentClassName,
      nextClass: nextClassName,
      remainingMinutes: remainingMinutes
    };
  }
  
  return {
    currentBlock: 'Unknown',
    currentClass: 'Error',
    nextClass: 'Error',
    remainingMinutes: 0
  };
},

startTimerCountdown(widget) {
  const updateCountdown = () => {
    const now = new Date();
    const currentTime = now.getHours() * 60 + now.getMinutes() + (now.getSeconds() / 60);
    
    const info = this.getCurrentClassInfo(widget.data.schedule);
    const countdownEl = document.getElementById(`timer-countdown-${widget.id}`);
    
    if (!countdownEl) return;
    
    const nowInSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
    
    const timeBlocks = [
      { name: 'Homeroom', start: 8 * 60 + 10, end: 8 * 60 + 18 },
      { name: 'TB1', start: 8 * 60 + 21, end: 9 * 60 + 1 },
      { name: 'TB2', start: 9 * 60 + 4, end: 9 * 60 + 44 },
      { name: 'TB3', start: 9 * 60 + 47, end: 10 * 60 + 27 },
      { name: 'TB4', start: 10 * 60 + 30, end: 11 * 60 + 10 },
      { name: 'Lunch', start: 11 * 60 + 13, end: 11 * 60 + 43 },
      { name: 'TB5', start: 11 * 60 + 46, end: 12 * 60 + 26 },
      { name: 'TB6', start: 12 * 60 + 29, end: 13 * 60 + 9 },
      { name: 'TB7', start: 13 * 60 + 12, end: 13 * 60 + 52 },
      { name: 'TB8', start: 13 * 60 + 55, end: 14 * 60 + 35 },
    ];
    
    let currentBlock = null;
    const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
    
    for (let block of timeBlocks) {
      if (currentTimeInMinutes >= block.start && currentTimeInMinutes < block.end) {
        currentBlock = block;
        break;
      }
    }
    
    if (currentBlock) {
      const endInSeconds = currentBlock.end * 60;
      const remainingSeconds = endInSeconds - nowInSeconds;
      
      if (remainingSeconds > 0) {
        const mins = Math.floor(remainingSeconds / 60);
        const secs = remainingSeconds % 60;
        countdownEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      } else {
        countdownEl.textContent = '00:00';
      }
    } else {
      countdownEl.textContent = '--:--';
    }
    
    setTimeout(updateCountdown, 1000);
  };
  
  updateCountdown();
},

startFocusMode(minutes, widget) {
  if (minutes > 999) {
    if (typeof showToast === 'function') {
      showToast('‚ö†Ô∏è Maximum focus time is 999 minutes!', 'error');
    }
    return;
  }
  
  if (typeof showToast === 'function') {
    showToast(`üéØ Starting ${minutes} minute focus mode...`, 'success');
  }
  
  const overlay = document.createElement('div');
  overlay.className = 'focus-mode-overlay';
  overlay.innerHTML = `
    <div class="focus-mode-title">Focus Mode</div>
    <div class="focus-mode-timer" id="focusTimer">--:--</div>
    <div class="focus-mode-message">Stay focused! KuppyCloaker is locked.</div>
    <button class="focus-mode-exit">Exit Focus Mode</button>
  `;
  
  document.body.appendChild(overlay);
  
  const endTime = Date.now() + (minutes * 60 * 1000);
  let timerInterval = null;
  
  const updateFocusTimer = () => {
    const remaining = endTime - Date.now();
    
    if (remaining <= 0) {
      clearInterval(timerInterval);
      overlay.remove();
      if (typeof showToast === 'function') {
        showToast('‚úÖ Focus session complete!', 'success');
      }
      createConfetti(window.innerWidth / 2, window.innerHeight / 2, 50);
      return;
    }
    
    const totalSeconds = Math.floor(remaining / 1000);
    const mins = Math.floor(totalSeconds / 60);
    const secs = totalSeconds % 60;
    
    const timerEl = document.getElementById('focusTimer');
    if (timerEl) {
      timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
  };
  
  updateFocusTimer();
  timerInterval = setInterval(updateFocusTimer, 1000);
  
  overlay.querySelector('.focus-mode-exit').onclick = () => {
    if (confirm('Are you sure you want to exit focus mode early?')) {
      clearInterval(timerInterval);
      overlay.remove();
      if (typeof showToast === 'function') {
        showToast('Focus mode cancelled', 'error');
      }
    }
  };
},

showTimerSettings(widget) {
  const backdrop = document.getElementById('modulesBackdrop');
  if (backdrop) backdrop.classList.add('show');
  
  const panel = document.createElement('div');
  panel.className = 'timer-settings-panel show';
  panel.innerHTML = `
    <button id="timerSettingsClose" style="position: absolute; top: 16px; right: 16px; background: none; border: none; color: var(--muted); font-size: 24px; cursor: pointer;">√ó</button>
    <h2 style="color: var(--accent); text-align: center; margin: 0 0 20px 0;">‚è∞ Timer Settings</h2>
    
    <h3 style="color: var(--text); font-size: 16px; margin-bottom: 12px;">Class Schedule</h3>
    <div class="class-input-row">
      <label>Block 1:</label>
      <input type="text" id="class-block1" value="${widget.data.schedule['Block 1'] || ''}" placeholder="e.g., Science">
    </div>
    <div class="class-input-row">
      <label>Block 2:</label>
      <input type="text" id="class-block2" value="${widget.data.schedule['Block 2'] || ''}" placeholder="e.g., Social Studies">
    </div>
    <div class="class-input-row">
      <label>Block 3:</label>
      <input type="text" id="class-block3" value="${widget.data.schedule['Block 3'] || ''}" placeholder="e.g., PE">
    </div>
    <div class="class-input-row">
      <label>Block 4:</label>
      <input type="text" id="class-block4" value="${widget.data.schedule['Block 4'] || ''}" placeholder="e.g., ISP / Language">
    </div>
    <div class="class-input-row">
      <label>Block 5:</label>
      <input type="text" id="class-block5" value="${widget.data.schedule['Block 5'] || ''}" placeholder="e.g., ELA">
    </div>
    <div class="class-input-row">
      <label>Block 6:</label>
      <input type="text" id="class-block6" value="${widget.data.schedule['Block 6'] || ''}" placeholder="e.g., Math">
    </div>
    <div class="class-input-row">
      <label>Block 7:</label>
      <input type="text" id="class-block7" value="${widget.data.schedule['Block 7'] || ''}" placeholder="e.g., Cycle">
    </div>
    <div class="class-input-row">
      <label>Block 8:</label>
      <input type="text" id="class-block8" value="${widget.data.schedule['Block 8'] || ''}" placeholder="e.g., ELA">
    </div>
    
    <button class="timer-btn" id="saveTimerSettings" style="width: 100%; margin-top: 20px;">Save Schedule</button>
  `;
  
  document.body.appendChild(panel);
  
  document.getElementById('timerSettingsClose').onclick = () => {
    panel.remove();
    if (backdrop) backdrop.classList.remove('show');
  };
  
  document.getElementById('saveTimerSettings').onclick = () => {
    const schedule = {
      'Block 1': document.getElementById('class-block1').value,
      'Block 2': document.getElementById('class-block2').value,
      'Block 3': document.getElementById('class-block3').value,
      'Block 4': document.getElementById('class-block4').value,
      'Block 5': document.getElementById('class-block5').value,
      'Block 6': document.getElementById('class-block6').value,
      'Block 7': document.getElementById('class-block7').value,
      'Block 8': document.getElementById('class-block8').value,
    };
    
    widget.data.schedule = schedule;
    localStorage.setItem('kuppyClassSchedule', JSON.stringify(schedule));
    this.saveWidgets();
    
    const widgetEl = document.querySelector(`[data-widget-id="${widget.id}"]`);
    if (widgetEl) {
      widgetEl.remove();
      this.renderWidget(widget);
    }
    
    panel.remove();
    if (backdrop) backdrop.classList.remove('show');
    
    if (typeof showToast === 'function') {
      showToast('‚úÖ Schedule saved!', 'success');
    }
  };
},
};

setTimeout(() => {
  ModulesSystem.init();
}, 500);

</script>
</body>
</html>
